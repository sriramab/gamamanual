<html><!-- Online page at https://github.com/gama-platform/gama/wiki/Tutorials/Recipes/ManipulateOSMDatas --><head><meta charset="utf-8"><title>ManipulateOSMDatas</title><script src="../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="manipulateosmdatas">ManipulateOSMDatas</h1>
<a class="dashAnchor" name="//apple_ref/Section/Manipulate%20OSM%20Datas"></a><h1 id="manipulate-osm-datas">Manipulate OSM Datas</h1>
<p>This section will be presented as a quick tutorial, showing how to proceed to manipulate OSM (Open street map) datas, and load them into GAMA. We will use the software <a href="http://www.qgis.org/en/site/">QGIS</a> to change the attributes of the OSM file.</p>
<p>From the website <a href="https://www.openstreetmap.org/">openstreetmap.org</a>, we will chose a place (in this example, we will take a neighborhood in New York City). Directly from the website, you can export the chosen area in the osm format.</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_1.png" alt="images/manipulate_OSM_file_1.png"></p>
<p>We have now to manipulate the attributes for the exported osm file.
Several software are possible to use, but we will focus on <a href="http://www.qgis.org/en/site/">QGIS</a>, which is totally free and provides a lot of possibilities in term of manipulation of data.</p>
<p>Once you have installed correctly QGIS, launch QGIS Desktop, and start to import the topology from the osm file.</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_2.png" alt="images/manipulate_OSM_file_2.png"></p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_3.png" alt="images/manipulate_OSM_file_3.png"></p>
<p>A message indicates that the import was successful. An output file .osm.db is created. You have now to export the topology to SpatiaLite.</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_4.png" alt="images/manipulate_OSM_file_4.png"></p>
<p>Specify the path for your DataBase file, then choose the export type (in your case, we will choose the type "Polygons (closed ways)"), choose an output layer name. If you want to use the open street maps attributes values, click on "Load from DB", and select the attributes you want to keep. Click OK then.</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_5.png" alt="images/manipulate_OSM_file_5.png"></p>
<p>A message indicates that the export was successful, and you have now a new layer created.</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_6.png" alt="images/manipulate_OSM_file_6.png"></p>
<p>We will now manipulate the attributes of your datafile. Right click on the layer, and select "Open Attribute Table".</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_7.png" alt="images/manipulate_OSM_file_7.png"></p>
<p>The table of attribute appears. Select the little pencil on the top-left corner of the window to modify the table.</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_8.png" alt="images/manipulate_OSM_file_8.png"></p>
<p>We will add an attribute manually. Click on the button "new column", choose a name and a type (we will choose the type "text").</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_9.png" alt="images/manipulate_OSM_file_9.png"></p>
<p>A new column appears at the end of the table. Let's fill some values (for instance blue / red). Once you finishes, click on the "save edit" button.</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_10.png" alt="images/manipulate_OSM_file_10.png"></p>
<p>Our file is now ready to be exported. Right click on the layer, and click on "Save As".</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_11.png" alt="images/manipulate_OSM_file_11.png"></p>
<p>Choose "shapefile" as format, choose a save path and click ok.</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_12.png" alt="images/manipulate_OSM_file_12.png"></p>
<p>Copy passed all the .shp created in the include folder of your GAMA project. You are now ready to write the model.</p>
<pre><code class="hljs arduino">model HowToUseOpenStreetMap

global {
    <span class="hljs-comment"><span class="hljs-comment">// Global variables related to the Management units </span></span>
    file shapeFile &lt;- file(<span class="hljs-string"><span class="hljs-string">'../includes/new_york.shp'</span></span>); 
    
    <span class="hljs-comment"><span class="hljs-comment">//definition of the environment size from the shapefile. </span></span>
    <span class="hljs-comment"><span class="hljs-comment">//Note that is possible to define it from several files by using: geometry shape &lt;- envelope(envelope(file1) + envelope(file2) + ...);</span></span>
    geometry shape &lt;- envelope(shapeFile);
    
    init {
        <span class="hljs-comment"><span class="hljs-comment">//Creation of elementOfNewYork agents from the shapefile (and reading some of the shapefile attributes)</span></span>
        create elementOfNewYork from: shapeFile 
            with: [elementId::<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">read</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>)), elementHeight::<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">read</span></span>(<span class="hljs-string"><span class="hljs-string">'height'</span></span>)), elementColor::<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">read</span></span>(<span class="hljs-string"><span class="hljs-string">'attrForGama'</span></span>))] ;
    }
}
    
species elementOfNewYork{
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> elementId;
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> elementHeight;
    <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> elementColor;
    
    aspect basic{
        draw shape color: (elementColor = <span class="hljs-string"><span class="hljs-string">"blue"</span></span>) ? <span class="hljs-meta"><span class="hljs-meta">#blue : ( (elementColor = </span><span class="hljs-string"><span class="hljs-meta"><span class="hljs-string">"red"</span></span></span><span class="hljs-meta">) ? #red : #yellow ) depth: elementHeight;</span></span>
    }
}   

experiment main type: gui {     
    output {
        <span class="hljs-built_in"><span class="hljs-built_in">display</span></span> HowToUseOpenStreetMap type:opengl {
            species elementOfNewYork aspect: basic; 
        }
    }
}
</code></pre>
<p>Here is the result, with a special colorization of the different elements regarding to the value of the attribute "attrForGama", and an elevation regarding to the value of the attribute "height".</p>
<p><img src="../../../github.com/wiki/gama-platform/gama/Tutorials/Recipes/resources/images/recipes/manipulate_OSM_file_13.png" alt="images/manipulate_OSM_file_13.png"></p>
<script>hljs.initHighlightingOnLoad();</script></body></html>