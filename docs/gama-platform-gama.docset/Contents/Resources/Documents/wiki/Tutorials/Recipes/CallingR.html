<html><!-- Online page at https://github.com/gama-platform/gama/wiki/Tutorials/Recipes/CallingR --><head><meta charset="utf-8"><title>CallingR</title><script src="../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="callingr">CallingR</h1>
<a class="dashAnchor" name="//apple_ref/Section/Calling%20R"></a><h1 id="calling-r">Calling R</h1>
<a class="dashAnchor" name="//apple_ref/Section/Introduction"></a><h2 id="introduction">Introduction</h2>
<table><thead><tr></tr></thead><tbody><tr></tr></tbody></table><p>R language is one of powerful data mining tools, and its community is very large in the world (See the website: <a href="http://www.r-project.org/">http://www.r-project.org/</a>). Adding the R language into GAMA is our strong endeavors to accelerate many statistical, data mining tools into GAMA.</p>
<p>RCaller 2.0 package (Website: <a href="http://code.google.com/p/rcaller/">http://code.google.com/p/rcaller/</a>) is used for GAMA 1.6.1.</p>
<a class="dashAnchor" name="//apple_ref/Section/Table%20of%20contents"></a><h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#configuration-in-gama">Configuration in GAMA</a></li>
<li><a href="#calling-r-from-gaml">Calling R from GAML</a>
<ul>
<li><a href="#calling-the-built-in-operators">Calling the built-in operators</a>
<ul>
<li><a href="#example-1">Example 1</a></li>
</ul>
</li>
<li><a href="#calling-r-codes-from-a-text-file-txt-without-the-parameters">Calling R codes from a text file (.txt) WITHOUT the parameters</a>
<ul>
<li><a href="#example-2">Example 2</a></li>
<li><a href="#correlationr-file">Correlation.R file</a></li>
</ul>
</li>
<li><a href="#output">Output</a>
<ul>
<li><a href="#example-3">Example 3</a></li>
<li><a href="#randomforestr-file">RandomForest.R file</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#load-the-package">Load the package:</a></li>
<li><a href="#read-data-from-iris">Read data from iris:</a></li>
<li><a href="#build-the-decision-tree">Build the decision tree:</a></li>
<li><a href="#build-the-random-forest-of-50-decision-trees">Build the random forest of 50 decision trees:</a></li>
<li><a href="#predict-the-acceptance-of-test-set">Predict the acceptance of test set:</a></li>
<li><a href="#calculate-the-accuracy">Calculate the accuracy:</a>
            * <a href="#output">Output</a>
        * <a href="#calling-r-codes-from-a-text-file-r-txt-with-the-parameters">Calling R codes from a text file (.R, .txt) WITH the parameters</a>
            * <a href="#example-4">Example 4</a>
            * <a href="#meanr-file">Mean.R file</a>
        * <a href="#output">Output</a>
            * <a href="#example-5">Example 5</a>
            * <a href="#addparamr-file">AddParam.R file</a>
            * <a href="#output">Output</a></li>
</ul>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Configuration%20in%20GAMA"></a><h2 id="configuration-in-gama">Configuration in GAMA</h2>
<p>1) Install R language into your computer.</p>
<p>2) In GAMA, select menu option: <strong>Edit/Preferences</strong>.</p>
<p>3) In "<strong>Config RScript's path</strong>", browse to your "<strong>Rscript</strong>" file (R language installed in your system).</p>
<p><strong>Notes</strong>: Ensure that install.packages("Runiversal") is already applied in R environment.</p>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Calling%20R%20from%20GAML"></a><h2 id="calling-r-from-gaml">Calling R from GAML</h2>
<a class="dashAnchor" name="//apple_ref/Section/Calling%20the%20built-in%20operators"></a><h3 id="calling-the-built-in-operators">Calling the built-in operators</h3>
<a class="dashAnchor" name="//apple_ref/Section/Example%201"></a><h4 id="example-1">Example 1</h4>
<pre><code class="hljs stata">model CallingR

<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> {
    <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> X &lt;- [2, 3, 1];
    <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> Y &lt;- [2, 12, 4]; 

    <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> result;
    
    init{
        write <span class="hljs-built_in"><span class="hljs-built_in">corR</span></span>(X, Y); <span class="hljs-comment"><span class="hljs-comment">// -&gt; 0.755928946018454</span></span>
        write meanR(X); <span class="hljs-comment"><span class="hljs-comment">// -&gt; 2.0</span></span>
    }
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Calling%20R%20codes%20from%20a%20text%20file%20(.R,.txt)%20WITHOUT%20the%20parameters"></a><h3 id="calling-r-codes-from-a-text-file-rtxt-without-the-parameters">Calling R codes from a text file (<strong>.R,</strong>.txt) WITHOUT the parameters</h3>
<p>Using <strong>R_compute(String RFile)</strong> operator. This operator DOESN’T ALLOW to add any parameters form the GAML code. All inputs is directly added into the R codes.
<strong>Remarks</strong>: Don’t let any white lines at the end of R codes. <strong>R_compute</strong> will return the last variable of R file, this parameter can be a basic type or a list.  Please ensure that the called packages must be installed before using.</p>
<a class="dashAnchor" name="//apple_ref/Section/Example%202"></a><h4 id="example-2">Example 2</h4>
<pre><code class="hljs applescript">model CallingR

<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>
{
    <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span>;

    init{
        <span class="hljs-literal"><span class="hljs-literal">result</span></span> &lt;- R_compute(<span class="hljs-string"><span class="hljs-string">"C:/YourPath/Correlation.R"</span></span>);
        <span class="hljs-built_in"><span class="hljs-built_in">write</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;
    }
}
</code></pre>
<p>Above syntax is deprecated, use following syntax with R_file instead of R_compute:</p>
<pre><code class="hljs applescript">model CallingR

<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>
{
    <span class="hljs-built_in"><span class="hljs-built_in">file</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span>;

    init{
        <span class="hljs-literal"><span class="hljs-literal">result</span></span> &lt;- R_file(<span class="hljs-string"><span class="hljs-string">"C:/YourPath/Correlation.R"</span></span>);
        <span class="hljs-built_in"><span class="hljs-built_in">write</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">contents</span></span>;
    }
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Correlation.R%20file"></a><h4 id="correlationr-file">Correlation.R file</h4>
<pre><code class="hljs oxygene">x &lt;- c(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)

y &lt;- c(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)

<span class="hljs-keyword"><span class="hljs-keyword">result</span></span> &lt;- cor(x, y, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">method</span></span></span><span class="hljs-function"> = "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pearson</span></span></span><span class="hljs-function">")
</span></span></code></pre>
<h3 id="output">Output</h3>
<p><code>result::[0.981980506061966]</code></p>
<a class="dashAnchor" name="//apple_ref/Section/Example%203"></a><h4 id="example-3">Example 3</h4>
<pre><code class="hljs applescript">model CallingR

<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>
{
    <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span>;

    init{
        <span class="hljs-literal"><span class="hljs-literal">result</span></span> &lt;- R_compute(<span class="hljs-string"><span class="hljs-string">"C:/YourPath/RandomForest.R"</span></span>);

        <span class="hljs-built_in"><span class="hljs-built_in">write</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;
    }
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/RandomForest.R%20file"></a><h4 id="randomforestr-file">RandomForest.R file</h4>
<pre><code class="hljs haskell"><span class="hljs-meta"><span class="hljs-meta"># Load the package:</span></span>

<span class="hljs-title"><span class="hljs-title">library</span></span>(randomForest)

<span class="hljs-meta"><span class="hljs-meta"># Read data from iris:</span></span>

<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">iris</span></span></span><span class="hljs-class">)</span></span>

<span class="hljs-title"><span class="hljs-title">nrow</span></span>&lt;-length(iris[,<span class="hljs-number"><span class="hljs-number">1</span></span>])

<span class="hljs-title"><span class="hljs-title">ncol</span></span>&lt;-length(iris[<span class="hljs-number"><span class="hljs-number">1</span></span>,])

<span class="hljs-title"><span class="hljs-title">idx</span></span>&lt;-sample(nrow,replace=<span class="hljs-type"><span class="hljs-type">FALSE</span></span>)

<span class="hljs-title"><span class="hljs-title">trainrow</span></span>&lt;-round(<span class="hljs-number"><span class="hljs-number">2</span></span>*nrow/<span class="hljs-number"><span class="hljs-number">3</span></span>)

<span class="hljs-title"><span class="hljs-title">trainset</span></span>&lt;-iris[idx[<span class="hljs-number"><span class="hljs-number">1</span></span>:trainrow],]

<span class="hljs-meta"><span class="hljs-meta"># Build the decision tree:</span></span>

<span class="hljs-title"><span class="hljs-title">trainset</span></span>&lt;-iris[idx[<span class="hljs-number"><span class="hljs-number">1</span></span>:trainrow],]

<span class="hljs-title"><span class="hljs-title">testset</span></span>&lt;-iris[idx[(trainrow+<span class="hljs-number"><span class="hljs-number">1</span></span>):nrow],]

<span class="hljs-meta"><span class="hljs-meta"># Build the random forest of 50 decision trees:</span></span>

<span class="hljs-title"><span class="hljs-title">model</span></span>&lt;-randomForest(x= trainset[,-ncol], y= trainset[,ncol], mtry=<span class="hljs-number"><span class="hljs-number">3</span></span>, ntree=<span class="hljs-number"><span class="hljs-number">50</span></span>)

<span class="hljs-meta"><span class="hljs-meta"># Predict the acceptance of test set: </span></span>

<span class="hljs-title"><span class="hljs-title">pred</span></span>&lt;-predict(model, testset[,-ncol], <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">="class")</span></span>

<span class="hljs-meta"><span class="hljs-meta"># Calculate the accuracy:</span></span>

<span class="hljs-title"><span class="hljs-title">acc</span></span>&lt;-sum(pred==testset[, ncol])/(nrow-trainrow)
</code></pre>
<h4 dash_ignored="yes" id="output-3">Output</h4>
<p><code>acc::[0.98]</code></p>
<a class="dashAnchor" name="//apple_ref/Section/Calling%20R%20codes%20from%20a%20text%20file%20(.R,%20.txt)%20WITH%20the%20parameters"></a><h3 id="calling-r-codes-from-a-text-file-r-txt-with-the-parameters">Calling R codes from a text file (.R, .txt) WITH the parameters</h3>
<p>Using <strong>R_compute_param(String RFile, List vectorParam)</strong> operator. This operator ALLOWS to add the parameters from the GAML code.</p>
<p><strong>Remarks</strong>: Don’t let any white lines at the end of R codes. <strong>R_compute_param</strong> will return the last variable of R file, this parameter can be a basic type or a list. Please ensure that the called packages must be installed before using.</p>
<a class="dashAnchor" name="//apple_ref/Section/Example%204"></a><h4 id="example-4">Example 4</h4>
<pre><code class="hljs applescript">model CallingR

<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>
{
    <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> X &lt;- [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>];
    <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span>;

    init{
        <span class="hljs-literal"><span class="hljs-literal">result</span></span> &lt;- R_compute_param(<span class="hljs-string"><span class="hljs-string">"C:/YourPath/Mean.R"</span></span>, X);
        <span class="hljs-built_in"><span class="hljs-built_in">write</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;
    }
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Mean.R%20file"></a><h4 id="meanr-file">Mean.R file</h4>
<p><code>result &lt;- mean(vectorParam)</code></p>
<h3 dash_ignored="yes" id="output-2">Output</h3>
<p><code>result::[3.33333333333333]</code></p>
<a class="dashAnchor" name="//apple_ref/Section/Example%205"></a><h4 id="example-5">Example 5</h4>
<pre><code class="hljs applescript">model CallingR

<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> {
    <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> X &lt;- [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>];
    <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span>;
    
        init{
        <span class="hljs-literal"><span class="hljs-literal">result</span></span> &lt;- R_compute_param(<span class="hljs-string"><span class="hljs-string">"C:/YourPath/AddParam.R"</span></span>, X);
        <span class="hljs-built_in"><span class="hljs-built_in">write</span></span> <span class="hljs-literal"><span class="hljs-literal">result</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;
    }
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/AddParam.R%20file"></a><h4 id="addparamr-file">AddParam.R file</h4>
<p><code>v1 &lt;- vectorParam[1]</code></p>
<p><code>v2&lt;-vectorParam[2]</code></p>
<p><code>v3&lt;-vectorParam[3]</code></p>
<p><code>result&lt;-v1+v2+v3</code></p>
<h4 dash_ignored="yes" id="output-4">Output</h4>
<p><code>result::[10]</code></p>
<script>hljs.initHighlightingOnLoad();</script></body></html>