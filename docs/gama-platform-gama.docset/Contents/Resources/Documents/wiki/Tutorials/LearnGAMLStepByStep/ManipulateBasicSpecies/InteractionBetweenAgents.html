<html><!-- Online page at https://github.com/gama-platform/gama/wiki/Tutorials/LearnGAMLStepByStep/ManipulateBasicSpecies/InteractionBetweenAgents --><head><meta charset="utf-8"><title>InteractionBetweenAgents</title><script src="../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="interactionbetweenagents">InteractionBetweenAgents</h1>
<a class="dashAnchor" name="//apple_ref/Section/Interaction%20between%20agents"></a><h1 id="interaction-between-agents">Interaction between agents</h1>
<p>In this part, we will learn how interaction between agents works. We will also present you a bunch of operators useful for your modelling. </p>
<a class="dashAnchor" name="//apple_ref/Section/Index"></a><h2 id="index">Index</h2>
<ul>
<li><a href="#the-ask-statement">The ask statement</a></li>
<li><a href="#pseudo-variables">Pseudo variables</a></li>
<li><a href="#some-useful-interaction-operators">Some useful interaction operators</a></li>
<li><a href="#example">Example</a></li>
</ul>
<a class="dashAnchor" name="//apple_ref/Section/The%20ask%20statement"></a><h2 id="the-ask-statement">The ask statement</h2>
<p>The <code>ask</code> statement can be used in any reflex or action scope. It is used to specify the interaction between the instances of your species and the other agents. You only have to specify the species of the agents you want to interact with. Here are the different ways of calling the ask statement:</p>
<ul>
<li>If you want to interact with one particular agent (for example, defined as an attribute of your species):</li>
</ul>
<pre><code class="hljs dts">species <span class="hljs-class"><span class="hljs-class">my_species </span></span>{
    agent target;
    reflex <span class="hljs-class"><span class="hljs-class">update </span></span>{
        ask <span class="hljs-class"><span class="hljs-class">target </span></span>{
            <span class="hljs-comment"><span class="hljs-comment">// statements</span></span>
        }
    }
}
</code></pre>
<ul>
<li>If you want to interact with a group of agents:</li>
</ul>
<pre><code class="hljs dts">species <span class="hljs-class"><span class="hljs-class">my_species </span></span>{
    list<span class="hljs-params"><span class="hljs-params">&lt;agent&gt;</span></span> targets;
    reflex <span class="hljs-class"><span class="hljs-class">update </span></span>{
        ask <span class="hljs-class"><span class="hljs-class">targets </span></span>{
            <span class="hljs-comment"><span class="hljs-comment">// statements</span></span>
        }
    }
}
</code></pre>
<ul>
<li>If you want to interact with agents, as if they were instance of a certain species (can raise an error if it's not the case!):</li>
</ul>
<pre><code class="hljs dts">species <span class="hljs-class"><span class="hljs-class">my_species </span></span>{
    list<span class="hljs-params"><span class="hljs-params">&lt;agent&gt;</span></span> targets;
    reflex <span class="hljs-class"><span class="hljs-class">update </span></span>{
        ask targets as:<span class="hljs-class"><span class="hljs-class">my_species </span></span>{
            <span class="hljs-comment"><span class="hljs-comment">// statements</span></span>
        }
    }
}
</code></pre>
<ul>
<li>If you want to interact with all the agent of a species:</li>
</ul>
<pre><code class="hljs dts">species <span class="hljs-class"><span class="hljs-class">my_species </span></span>{
    list<span class="hljs-params"><span class="hljs-params">&lt;agent&gt;</span></span> targets;
    reflex <span class="hljs-class"><span class="hljs-class">update </span></span>{
        ask <span class="hljs-class"><span class="hljs-class">other_species </span></span>{
            <span class="hljs-comment"><span class="hljs-comment">// statements</span></span>
        }
    }
}

species <span class="hljs-class"><span class="hljs-class">other_species </span></span>{
}
</code></pre>
<p>Note that you can use the attribute <em>population</em> of <code>species</code> if you find it more explicit:</p>
<pre><code class="hljs stylus">ask other_species<span class="hljs-selector-class"><span class="hljs-selector-class">.population</span></span>
</code></pre>
<ul>
<li>If you want to interact with all the agent of a particular species from a list of agents (for example, using the global variable "agents"):</li>
</ul>
<pre><code class="hljs dts">species <span class="hljs-class"><span class="hljs-class">my_specie </span></span>{
    reflex <span class="hljs-class"><span class="hljs-class">update </span></span>{
        ask species of_species <span class="hljs-class"><span class="hljs-class">my_specie </span></span>{
            <span class="hljs-comment"><span class="hljs-comment">// statements</span></span>
        }
    }
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Pseudo%20variables"></a><h2 id="pseudo-variables">Pseudo variables</h2>
<p>Once you are in the ask scope, you can use some pseudo variables to refer to the receiver agent (the one specify just after the ask statement) or the transmitter agent (the agent which is asking). 
We use the pseudo variable <code>self</code> to refer to the receiver agent, and the pseudo variable <code>myself</code> to refer to the transmitter agent. The pseudo variable <code>self</code> can be omitted when calling actions or attributes.</p>
<pre><code class="hljs xquery">species speciesA {
    init {
        name &lt;- <span class="hljs-string"><span class="hljs-string">"speciesA"</span></span>;
    }
    reflex update {
        ask speciesB {
write name; // output : <span class="hljs-string"><span class="hljs-string">"speciesB"</span></span>          
write self.name; // output : <span class="hljs-string"><span class="hljs-string">"speciesB"</span></span>
            write myself.name; // output : <span class="hljs-string"><span class="hljs-string">"speciesA"</span></span>
        }
    }
}

species speciesB {
    init {
        name &lt;- <span class="hljs-string"><span class="hljs-string">"speciesB"</span></span>;
    }
}
</code></pre>
<p>Now, if we introduce a third species, we can write an <code>ask</code> statement inside another. </p>
<pre><code class="hljs xquery">species speciesA {
    init {
        name &lt;- <span class="hljs-string"><span class="hljs-string">"speciesA"</span></span>;
    }
    reflex update {
        ask speciesB {
            write self.name; // output : <span class="hljs-string"><span class="hljs-string">"speciesB"</span></span>
            write myself.name; // output : <span class="hljs-string"><span class="hljs-string">"speciesA"</span></span>
            ask speciesC {
                write self.name; // output : <span class="hljs-string"><span class="hljs-string">"speciesC"</span></span>
                write myself.name; // output : <span class="hljs-string"><span class="hljs-string">"speciesB"</span></span>
            }
        }
    }
}

species speciesB {
    init {
        name &lt;- <span class="hljs-string"><span class="hljs-string">"speciesB"</span></span>;
    }
}

species speciesC {
    init {
        name &lt;- <span class="hljs-string"><span class="hljs-string">"speciesC"</span></span>;
    }
}
</code></pre>
<p>Nb: try to avoid multiple imbrications of ask statements. Most of the time, there is another way to do the same thing.</p>
<a class="dashAnchor" name="//apple_ref/Section/Some%20useful%20interaction%20operators"></a><h2 id="some-useful-interaction-operators">Some useful interaction operators</h2>
<p>The operator <code>at_distance</code> can be used to know the list of agents that are in a certain distance from another agent.</p>
<pre><code class="hljs sqf">species my_species {
    reflex update {
        <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">agent</span></span>&gt; neighbours &lt;- <span class="hljs-built_in"><span class="hljs-built_in">agents</span></span> at_distance(<span class="hljs-number"><span class="hljs-number">5</span></span>);
        <span class="hljs-comment"><span class="hljs-comment">// neighbours contains the list of all the agents located at a distance &lt;= 5 from the caller agent.</span></span>
    }
}
</code></pre>
<p>The operator <code>closest_to</code> returns the closest agent of a position among a container.</p>
<pre><code class="hljs smali">species my_species {
    reflex update {
        agent agentA &lt;- agents closest_to(self);
        // agentA contains the closest agent from the caller agent.
        agent agentB &lt;- other_specie closest_to({2,3});
        // agentB contains the closest<span class="hljs-built_in"><span class="hljs-built_in"> instance </span></span>of other_specie from the location {2,3}.
    }
}

species other_specie {
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Example"></a><h2 id="example">Example</h2>
<p>To practice those notions, here is a short basic example. Let's build a model with a fix number of agents with a circle shape. They can move randomly on the environment, and when they are close enough from another agent, a line is displayed between them. This line is destroyed when the distance between the two agents is too important.
Hint: use the operator <code>polyline</code> to construct a line. List the points between angle brackets <code>[]</code>.</p>
<p><img src="../../../../github.com/wiki/gama-platform/gama/Tutorials/LearnGAMLStepByStep/ManipulateBasicSpecies/resources/images/manipulateBasicSpecies/connect_the_neighbours.png" alt="images/connect_the_neighbours.png"> </p>
<p>Here is one example of implementation:</p>
<pre><code class="hljs sqf">model connect_the_neighbours

global{
    float <span class="hljs-built_in"><span class="hljs-built_in">speed</span></span> &lt;- <span class="hljs-number"><span class="hljs-number">0.2</span></span>;
    float distance_to_intercept &lt;- <span class="hljs-number"><span class="hljs-number">10.0</span></span>;
    int number_of_circle &lt;- <span class="hljs-number"><span class="hljs-number">100</span></span>;
    init {
        create my_species number:number_of_circle;
    }
}

species my_species {
    reflex <span class="hljs-built_in"><span class="hljs-built_in">move</span></span> {
        <span class="hljs-built_in"><span class="hljs-built_in">location</span></span> &lt;- {<span class="hljs-built_in"><span class="hljs-built_in">location</span></span>.x+rnd(-<span class="hljs-built_in"><span class="hljs-built_in">speed</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">speed</span></span>),<span class="hljs-built_in"><span class="hljs-built_in">location</span></span>.y+rnd(-<span class="hljs-built_in"><span class="hljs-built_in">speed</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">speed</span></span>)};
    }
    aspect <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {
        draw circle(<span class="hljs-number"><span class="hljs-number">1</span></span>);
        ask my_species at_distance(distance_to_intercept) {
            draw polyline([self.<span class="hljs-built_in"><span class="hljs-built_in">location</span></span>,myself.<span class="hljs-built_in"><span class="hljs-built_in">location</span></span>]) color:<span class="hljs-meta"><span class="hljs-meta">#black;</span></span>
        }
    }
}

experiment my_experiment <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>:gui
{
    output{
        display myDisplay {
            species my_species aspect:<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>;
        }
    }
}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>