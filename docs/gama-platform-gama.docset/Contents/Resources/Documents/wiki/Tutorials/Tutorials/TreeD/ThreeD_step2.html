<html><!-- Online page at https://github.com/gama-platform/gama/wiki/Tutorials/Tutorials/TreeD/ThreeD_step2 --><head><meta charset="utf-8"><title>ThreeD_step2</title><script src="../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="threed_step2">ThreeD_step2</h1>
<a class="dashAnchor" name="//apple_ref/Section/2.%20Moving%20Cells"></a><h1 id="2-moving-cells">2. Moving Cells</h1>
<p>This second step model adds the <strong>moving3D</strong> skills to the <strong>cell</strong> agents and simply makes move the <strong>cells</strong> agent by defining a reflex that will call the action <strong>move</strong>. We will also add additional visual information to the display.</p>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Formulation"></a><h2 id="formulation">Formulation</h2>
<ul>
<li>Redefining the shape of the world with a 3D Shape.
<ul>
<li>Attaching new skills (<strong>moving3D</strong>) to <strong>cells</strong> agent.</li>
<li>Modify <strong>cells</strong> aspect</li>
<li>Add a graphics layer</li>
</ul>
</li>
</ul>
<p><a href="http://www.youtube.com/watch?feature=player_embedded&amp;v=_QqUbC0MWRU" target="_blank"><img src="../../../../img.youtube.com/vi/_QqUbC0MWRU/0.jpg" width="425" height="344"></a></p>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Model%20Definition"></a><h2 id="model-definition">Model Definition</h2>
<table><thead><tr></tr></thead><tbody><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Global%20Section"></a><h3 id="global-section">Global Section</h3>
<a class="dashAnchor" name="//apple_ref/Section/Global%20variable"></a><h4 id="global-variable">Global variable</h4>
<p>We use a new global variable called _environmentSize_that to define the size of our 3D environment.
In the global section we define the new variable</p>
<pre><code class="hljs axapta"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> environmentSize &lt;<span class="hljs-number"><span class="hljs-number">-100</span></span>;
</code></pre>
<p>Then we redefine the shape of the world (by default the shape of the world is a 100x100 square) as cube that will have the size defined by the <em>environment_size</em> variable. To do so we change the shape of the world in the <strong>global</strong> section:</p>
<pre><code class="hljs mipsasm">geometry <span class="hljs-keyword"><span class="hljs-keyword">shape </span></span>&lt;- cube(environmentSize)<span class="hljs-comment"><span class="hljs-comment">;    </span></span>
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Model%20initialization"></a><h4 id="model-initialization">Model initialization</h4>
<p>When we create the <strong>cells</strong> agent we want to place them randomly in the 3D environement. To do so we set the location with a random value for <em>x</em>, <em>y</em> and <em>z</em> between 0 and <em>environmentSize</em>.</p>
<pre><code class="hljs crmsh">create cells <span class="hljs-keyword"><span class="hljs-keyword">number</span></span>: nb_cells { 
  <span class="hljs-keyword"><span class="hljs-keyword">location</span></span> <span class="hljs-title"><span class="hljs-title">&lt;- {rnd</span></span>(environmentSize), rnd(environmentSize), rnd(environmentSize)};       
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Moving3D%20skills"></a><h3 id="moving3d-skills">Moving3D skills</h3>
<p>In the previous example, we only created <strong>cells</strong> agent that did not have any behavior. In this step we want to make move the <strong>cells</strong> agent. To do so we add a <strong>moving3D</strong> skills to the cells.</p>
<p>More information on built-in skills proposed by Gama can be found <a href="https://github.com/wiki/gama-platform/gama/Tutorials/Tutorials/TreeD/BuiltInSkills.html">here</a></p>
<pre><code class="hljs less"><span class="hljs-selector-tag"><span class="hljs-selector-tag">species</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cells</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">skills</span></span>:<span class="hljs-selector-attr"><span class="hljs-selector-attr">[moving3D]</span></span>{
...     
}
</code></pre>
<p>Then we define a new reflex for the species <strong>cells</strong> that consists in calling the action <em>move</em> bundled in <strong>moving3D</strong> skills.</p>
<pre><code class="hljs dos">reflex <span class="hljs-built_in"><span class="hljs-built_in">move</span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">move</span></span>;
}                       
</code></pre>
<p>Finally we modify a bit the aspect of the sphere to set its size according to the <em>environmentSize</em> global variable previously defined.</p>
<pre><code class="hljs processing">aspect <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {
  <span class="hljs-title"><span class="hljs-title">draw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">sphere</span></span>(environmentSize*<span class="hljs-number"><span class="hljs-number">0.01</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">color</span></span>:#<span class="hljs-built_in"><span class="hljs-built_in">blue</span></span>;   
}
</code></pre>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Experiment"></a><h3 id="experiment">Experiment</h3>
<p>The experiment is the same as the previous one except that we will display the bounds of the environment by using the <strong>graphics</strong> layer.</p>
<pre><code class="hljs maxima">graphics <span class="hljs-string"><span class="hljs-string">"env"</span></span>{
  <span class="hljs-built_in"><span class="hljs-built_in">draw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cube</span></span>(environmentSize) <span class="hljs-built_in"><span class="hljs-built_in">color</span></span>: #black empty:<span class="hljs-literal"><span class="hljs-literal">true</span></span>;  
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Output"></a><h4 id="output">Output</h4>
<pre><code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">output</span></span> {
  <span class="hljs-attribute"><span class="hljs-attribute">display</span></span> View1 type:opengl{
    <span class="hljs-attribute"><span class="hljs-attribute">graphics</span></span> <span class="hljs-string"><span class="hljs-string">"env"</span></span>{
      <span class="hljs-attribute"><span class="hljs-attribute">draw</span></span> cube(environmentSize) color: <span class="hljs-comment"><span class="hljs-comment">#black empty:true;  </span></span>
    }
    species cells;  
  }
}
</code></pre>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Complete%20Model"></a><h2 id="complete-model">Complete Model</h2>
<p>The GIT version of the model can be found here [Model 02.gaml](<a href="https://github.com/gama-platform/gama/tree/master/msi.gama.models/models/Tutorials/3D/models/Model">https://github.com/gama-platform/gama/tree/master/msi.gama.models/models/Tutorials/3D/models/Model</a> 02.gaml)</p>
<pre><code class="hljs processing">model Tuto3D   

global {
  <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> nb_cells &lt;<span class="hljs-number"><span class="hljs-number">-100</span></span>;
  <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> environmentSize &lt;<span class="hljs-number"><span class="hljs-number">-100</span></span>;
  geometry <span class="hljs-built_in"><span class="hljs-built_in">shape</span></span> &lt;- cube(environmentSize);  
  init { 
    create cells number: nb_cells { 
      location &lt;- {rnd(environmentSize), rnd(environmentSize), rnd(environmentSize)};       
    } 
  }  
} 
  
species cells skills:[moving3D]{  
    
  reflex move{
    do move;
  }                     
  aspect <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {
    <span class="hljs-title"><span class="hljs-title">draw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">sphere</span></span>(environmentSize*<span class="hljs-number"><span class="hljs-number">0.01</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">color</span></span>:#<span class="hljs-built_in"><span class="hljs-built_in">blue</span></span>;   
  }
}

experiment Tuto3D  type: gui {
  parameter <span class="hljs-string"><span class="hljs-string">"Initial number of cells: "</span></span> var: nb_cells <span class="hljs-built_in"><span class="hljs-built_in">min</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">max</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span> category: <span class="hljs-string"><span class="hljs-string">"Cells"</span></span> ;
  output {
    display View1 type:opengl{
      graphics <span class="hljs-string"><span class="hljs-string">"env"</span></span>{
        <span class="hljs-title"><span class="hljs-title">draw</span></span> cube(environmentSize) <span class="hljs-built_in"><span class="hljs-built_in">color</span></span>: #black empty:<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;    
      }
      species cells;
    }
  }
}
</code></pre>
<blockquote>
</blockquote>
<script>hljs.initHighlightingOnLoad();</script></body></html>