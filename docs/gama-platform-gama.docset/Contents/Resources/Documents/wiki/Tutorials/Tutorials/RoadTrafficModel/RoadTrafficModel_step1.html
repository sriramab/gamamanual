<html><!-- Online page at https://github.com/gama-platform/gama/wiki/Tutorials/Tutorials/RoadTrafficModel/RoadTrafficModel_step1 --><head><meta charset="utf-8"><title>RoadTrafficModel_step1</title><script src="../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="roadtrafficmodel_step1">RoadTrafficModel_step1</h1>
<a class="dashAnchor" name="//apple_ref/Section/1.%20Loading%20of%20GIS%20Data"></a><h1 id="1-loading-of-gis-data">1. Loading of GIS Data</h1>
<p>This first step Illustrates how to load GIS data (shapefiles) and to read attributes from GIS data.</p>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Formulation"></a><h2 id="formulation">Formulation</h2>
<ul>
<li>Set the time duration of a time step to 10 minutes
<ul>
<li>Load, agentify and display two layers of GIS data (building and road). Agentifying a GIS element will allow us to give it a behavior later on (thus not being simply a static/passive object).</li>
<li>Read the 'NATURE' attribute of the building data: the buildings of 'Residential' type will be colored in gray, the buildings of 'Industrial' type will be color in blue.</li>
</ul>
</li>
</ul>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Model%20Definition"></a><h2 id="model-definition">Model Definition</h2>
<a class="dashAnchor" name="//apple_ref/Section/species"></a><h3 id="species">species</h3>
<p>In this first model, we have to define two species of agents: the <strong>building</strong> agents and the <strong>road</strong> ones. These agents will not have a particular behavior, they will just be displayed.
For each of these species, we define a new attribute: <strong>color</strong> of type <em>rgb</em>, with for initial value: "black" for the <strong>road</strong> agent and "gray" (by default) for the <strong>building</strong> agent.
Concerning the <strong>building</strong> agent, we define a second attribute named <strong>type</strong> representing the type of the building ("Residential" or "Industrial").
At last, we define an aspect for these species. In this model, we want to represent the geometry of the agent, we then use the keyword <strong>draw</strong> that allow to draw a given geometry. In order to draw the geometry of the agent we use the attribute <strong>shape</strong> (which is a built-in attribute of all agents).</p>
<pre><code class="hljs mipsasm">species <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>{
    string type<span class="hljs-comment"><span class="hljs-comment">; </span></span>
    rgb color &lt;- <span class="hljs-comment"><span class="hljs-comment">#gray  ;</span></span>
    
    aspect <span class="hljs-keyword"><span class="hljs-keyword">base </span></span>{
        draw <span class="hljs-keyword"><span class="hljs-keyword">shape </span></span>color: color <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    }
}

species road  {
    rgb color &lt;- <span class="hljs-comment"><span class="hljs-comment">#black ;</span></span>
    
        aspect <span class="hljs-keyword"><span class="hljs-keyword">base </span></span>{
        draw <span class="hljs-keyword"><span class="hljs-keyword">shape </span></span>color: color <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    }
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/parameters"></a><h3 id="parameters">parameters</h3>
<p>GAMA allows to automatically read GIS data that are formatted as shapefiles. In order to let the user chooses his/her shapefiles, we define three parameters. One allowing the user to choose the road shapefile, one allowing him/her to choose the building shapefile, and, at last, one allowing him/her to choose the bounds shapefile. We will come back later on the notion of "bounds" in GAMA.</p>
<p>Definition of the three global variables of type <em>file</em> concerning the GIS files:</p>
<pre><code class="hljs stata"><span class="hljs-keyword"><span class="hljs-keyword">global</span></span> {
   <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> shape_file_buildings &lt;- <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>(<span class="hljs-string"><span class="hljs-string">"../includes/building.shp"</span></span>);
   <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> shape_file_roads &lt;- <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>(<span class="hljs-string"><span class="hljs-string">"../includes/road.shp"</span></span>);
   <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> shape_file_bounds &lt;- <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>(<span class="hljs-string"><span class="hljs-string">"../includes/bounds.shp"</span></span>);
}
</code></pre>
<p>In the experiment section, we add three parameters to allow the user to change the shapefile used directly through the UI:</p>
<pre><code class="hljs gams">experiment road_traffic type: gui {
   <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-string"><span class="hljs-string">"Shapefile for the buildings:"</span></span> var: shape_file_buildings <span class="hljs-comment"><span class="hljs-comment">category:</span></span> <span class="hljs-comment"><span class="hljs-comment">"GIS"</span></span> ;
   <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-string"><span class="hljs-string">"Shapefile for the roads:"</span></span> var: shape_file_roads <span class="hljs-comment"><span class="hljs-comment">category:</span></span> <span class="hljs-comment"><span class="hljs-comment">"GIS"</span></span> ;
   <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-string"><span class="hljs-string">"Shapefile for the bounds:"</span></span> var: shape_file_bounds <span class="hljs-comment"><span class="hljs-comment">category:</span></span> <span class="hljs-comment"><span class="hljs-comment">"GIS"</span></span> ;
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/agentification%20of%20GIS%20data"></a><h3 id="agentification-of-gis-data">agentification of GIS data</h3>
<p>In GAMA, the agentification of GIS data is very straightforward: it only requires to use the <strong>create</strong> command with the <strong>from</strong> facet to pass the shapefile. Each object of the shapefile will be directly used to instantiate an agent of the specified species. The reading of an attribute in a shapefile is also very simple. It only requires to use the <strong>with</strong> facet: the argument of this facet is a dictionary of which the keys are the names of the agent attributes and the value the <strong>read</strong> command followed by the name of the shapefile attribute ("NATURE" in our case).</p>
<p>Init section of the global block: creation of the road and building agents from the shape files. Concerning the <strong>building</strong> agents, reading of the "NATURE" attribute of the shapefile to initiate the value of the <strong>type</strong> attribute. If the <strong>type</strong> attribute is equal to "Industrial" set the <strong>color</strong> attribute to "blue".</p>
<pre><code class="hljs nimrod">global {
  ...
  init {
   create building <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: shape_file_buildings <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>::read (<span class="hljs-string"><span class="hljs-string">"NATURE"</span></span>)] {
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=<span class="hljs-string"><span class="hljs-string">"Industrial"</span></span> {
         color &lt;- <span class="hljs-comment"><span class="hljs-comment">#blue ;</span></span>
      }
   }
   create road <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: shape_file_roads ;
  } 
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/time%20step"></a><h3 id="time-step">time step</h3>
<p>In GAMA, by default, a time step represents 1 second. It is possible to redefine this value by overriding the <strong>step</strong> global variable. This value of the time step is used by the moving primitives of GAMA.</p>
<p>In our model, we define that a step represent 10 minutes. Note that it is possible to define the unit of a value by using <em>#</em> + unit name. For instance, #mn or #km for kilometers.</p>
<pre><code class="hljs lasso"><span class="hljs-built_in"><span class="hljs-built_in">global</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">...</span></span>
  float step &lt;- <span class="hljs-number"><span class="hljs-number">10</span></span> #mn;
  <span class="hljs-attr"><span class="hljs-attr">...</span></span>
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/environment"></a><h3 id="environment">environment</h3>
<p>Building a GIS environment in GAMA requires nothing special, just to define the bounds of the environment, i.e. the geometry of the world agent. It is possible to use a shapefile to automatically define it by computing its envelope. In this model, we use a specific shapefile to define it. However, it would been possible to use the road shapefile to define it and let GAMA computes it enveloppe automatically.</p>
<pre><code class="hljs lasso"><span class="hljs-built_in"><span class="hljs-built_in">global</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">...</span></span>
  geometry shape &lt;- envelope(shape_file_bounds); 
  <span class="hljs-attr"><span class="hljs-attr">...</span></span>
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/display"></a><h3 id="display">display</h3>
<p>We define a display to visualize the road and building agents. We use for that the classic <strong>species</strong> keyword. In order to optimize the display we use an opengl display (facet <strong>type: opengl</strong>).</p>
<p>In the <strong>experiment</strong> block:</p>
<pre><code class="hljs mipsasm">output {
   <span class="hljs-keyword"><span class="hljs-keyword">display </span></span>city_display type:opengl {
      species <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
      species road aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
   }
}
</code></pre>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Complete%20Model"></a><h2 id="complete-model">Complete Model</h2>
<pre><code class="hljs mipsasm">model tutorial_gis_city_traffic

global {
    file <span class="hljs-keyword"><span class="hljs-keyword">shape_file_buildings </span></span>&lt;- file(<span class="hljs-string"><span class="hljs-string">"../includes/building.shp"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span>
    file <span class="hljs-keyword"><span class="hljs-keyword">shape_file_roads </span></span>&lt;- file(<span class="hljs-string"><span class="hljs-string">"../includes/road.shp"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span>
    file <span class="hljs-keyword"><span class="hljs-keyword">shape_file_bounds </span></span>&lt;- file(<span class="hljs-string"><span class="hljs-string">"../includes/bounds.shp"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span>
    geometry <span class="hljs-keyword"><span class="hljs-keyword">shape </span></span>&lt;- envelope(<span class="hljs-keyword"><span class="hljs-keyword">shape_file_bounds);
</span></span>    float step &lt;- <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">#mn;</span></span>
    
    init {
        create <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>from: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_buildings </span></span>with: [type::string(read (<span class="hljs-string"><span class="hljs-string">"NATURE"</span></span>))] {
            if type=<span class="hljs-string"><span class="hljs-string">"Industrial"</span></span> {
                color &lt;- <span class="hljs-comment"><span class="hljs-comment">#blue ;</span></span>
            }
        }
        create road from: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_roads </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
    }
}

species <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>{
    string type<span class="hljs-comment"><span class="hljs-comment">; </span></span>
    rgb color &lt;- <span class="hljs-comment"><span class="hljs-comment">#gray  ;</span></span>
    
    aspect <span class="hljs-keyword"><span class="hljs-keyword">base </span></span>{
        draw <span class="hljs-keyword"><span class="hljs-keyword">shape </span></span>color: color <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    }
}

species road  {
    rgb color &lt;- <span class="hljs-comment"><span class="hljs-comment">#black ;</span></span>
    aspect <span class="hljs-keyword"><span class="hljs-keyword">base </span></span>{
        draw <span class="hljs-keyword"><span class="hljs-keyword">shape </span></span>color: color <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    }
}

experiment road_traffic type: gui {
    parameter <span class="hljs-string"><span class="hljs-string">"Shapefile for the buildings:"</span></span> var: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_buildings </span></span>category: <span class="hljs-string"><span class="hljs-string">"GIS"</span></span> <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    parameter <span class="hljs-string"><span class="hljs-string">"Shapefile for the roads:"</span></span> var: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_roads </span></span>category: <span class="hljs-string"><span class="hljs-string">"GIS"</span></span> <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    parameter <span class="hljs-string"><span class="hljs-string">"Shapefile for the bounds:"</span></span> var: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_bounds </span></span>category: <span class="hljs-string"><span class="hljs-string">"GIS"</span></span> <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    
    output {
        <span class="hljs-keyword"><span class="hljs-keyword">display </span></span>city_display type:opengl {
            species <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
            species road aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
        }
    }
}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>