<html><!-- Online page at https://github.com/gama-platform/gama/wiki/Tutorials/Tutorials/RoadTrafficModel/RoadTrafficModel_step2 --><head><meta charset="utf-8"><title>RoadTrafficModel_step2</title><script src="../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="roadtrafficmodel_step2">RoadTrafficModel_step2</h1>
<a class="dashAnchor" name="//apple_ref/Section/2.%20People%20Agents"></a><h1 id="2-people-agents">2. People Agents</h1>
<p>This second step Illustrates how to obtain a random point inside a geometry. We will also define some moving agent called <em>people</em>.</p>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Formulation"></a><h2 id="formulation">Formulation</h2>
<ul>
<li>Define a new species of agents: the <strong>people</strong> agents. The <strong>people</strong> agents have a point for geometry and are represented by a yellow circle of radius 10m.
<ul>
<li>At initialization, 100 <strong>people</strong> agents are created. Each <strong>people</strong> agent is placed inside a building of type 'Residential' (randomly selected).</li>
</ul>
</li>
</ul>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Model%20Definition"></a><h2 id="model-definition">Model Definition</h2>
<a class="dashAnchor" name="//apple_ref/Section/species"></a><h3 id="species">species</h3>
<p>We define a new species of agents: the <strong>people</strong> agents. In this model, these agents will not have a specific behavior yet. They will be just displayed. Thus, we just have to define an aspect for the agents. We want to represent the <strong>people</strong> agents by a yellow circle of radius 10m. We then use the <strong>circle</strong> value for the <strong>shape</strong> facet of the <strong>draw</strong> command, with the expected color and radius size (defined by the facet <strong>size</strong>).</p>
<pre><code class="hljs hsp">species people {
    rgb <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> &lt;- <span class="hljs-meta"><span class="hljs-meta">#yellow ;</span></span>
    
    aspect base {
        draw <span class="hljs-keyword"><span class="hljs-keyword">circle</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">color</span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
    }
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/parameter"></a><h3 id="parameter">parameter</h3>
<p>We have to add a new parameter: the number of <strong>people</strong> agents created</p>
<p>In the global section, definition of the <strong>nb_people</strong> variable:</p>
<pre><code class="hljs axapta">   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nb_people &lt;- <span class="hljs-number"><span class="hljs-number">100</span></span>;
</code></pre>
<p>In the experiment section, definition of the parameter:</p>
<pre><code class="hljs gams">   <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-string"><span class="hljs-string">"Number of people agents"</span></span> var: nb_people <span class="hljs-comment"><span class="hljs-comment">category:</span></span> <span class="hljs-comment"><span class="hljs-comment">"People"</span></span> ;
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/creation%20and%20placement%20of%20the%20people%20agents"></a><h3 id="creation-and-placement-of-the-people-agents">creation and placement of the people agents</h3>
<p>We have to create <strong>nb_people</strong> <strong>people</strong> agents. Each <strong>people</strong> is placed in a buildings of type 'Residential' randomly selected. In order to simplify the GAML code, we defined a local variable <strong>residential_buildings</strong> that represent the list of buildings of type 'Residential'. To filter the list of <strong>building</strong> agents (obtained by <strong>building</strong>), we use the <strong>where</strong> operator. We use the operator <strong>one_of</strong> to randomly select one agent of this list. There are several ways to place a <strong>people</strong> agent inside this building. In this tutorial, we choose to use the <strong>any_location_in</strong> operator. This operator returns a random point situated inside the operand geometry.</p>
<pre><code class="hljs applescript"><span class="hljs-keyword"><span class="hljs-keyword">global</span></span> {
    ...
    init {
        create building <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: shape_file_buildings <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>: [type::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">read</span></span> (<span class="hljs-string"><span class="hljs-string">"NATURE"</span></span>))] {
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type=<span class="hljs-string"><span class="hljs-string">"Industrial"</span></span> {
                color &lt;- <span class="hljs-comment"><span class="hljs-comment">#blue ;</span></span>
            }
        }
        create road <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: shape_file_roads ;
        <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;building&gt; residential_buildings &lt;- building <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> (each.type=<span class="hljs-string"><span class="hljs-string">"Residential"</span></span>);
        create people <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>: nb_people {
            location &lt;- any_location_in (one_of (residential_buildings));
        }
    }
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/display"></a><h3 id="display">display</h3>
<p>We add the <strong>people</strong> agent in the defined display.</p>
<pre><code class="hljs mipsasm">   output {
      <span class="hljs-keyword"><span class="hljs-keyword">display </span></span>city_display {
         species <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
         species road aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
         species people aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
      }
   }
</code></pre>
<table><thead><tr></tr></thead><tbody><tr></tr><tr></tr></tbody></table><a class="dashAnchor" name="//apple_ref/Section/Complete%20Model"></a><h2 id="complete-model">Complete Model</h2>
<pre><code class="hljs mipsasm">model tutorial_gis_city_traffic

global {
    file <span class="hljs-keyword"><span class="hljs-keyword">shape_file_buildings </span></span>&lt;- file(<span class="hljs-string"><span class="hljs-string">"../includes/building.shp"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span>
    file <span class="hljs-keyword"><span class="hljs-keyword">shape_file_roads </span></span>&lt;- file(<span class="hljs-string"><span class="hljs-string">"../includes/road.shp"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span>
    file <span class="hljs-keyword"><span class="hljs-keyword">shape_file_bounds </span></span>&lt;- file(<span class="hljs-string"><span class="hljs-string">"../includes/bounds.shp"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span>
    geometry <span class="hljs-keyword"><span class="hljs-keyword">shape </span></span>&lt;- envelope(<span class="hljs-keyword"><span class="hljs-keyword">shape_file_bounds);
</span></span>    float step &lt;- <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">#mn;</span></span>
    int nb_people &lt;- <span class="hljs-number"><span class="hljs-number">100</span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
    
    init {
        create <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>from: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_buildings </span></span>with: [type::string(read (<span class="hljs-string"><span class="hljs-string">"NATURE"</span></span>))] {
            if type=<span class="hljs-string"><span class="hljs-string">"Industrial"</span></span> {
                color &lt;- <span class="hljs-comment"><span class="hljs-comment">#blue ;</span></span>
            }
        }
        create road from: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_roads </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
        list&lt;<span class="hljs-keyword"><span class="hljs-keyword">building&gt; </span></span>residential_buildings &lt;- <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>where (each.type=<span class="hljs-string"><span class="hljs-string">"Residential"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span>
        create people number: nb_people {
            location &lt;- any_location_in (one_of (residential_buildings))<span class="hljs-comment"><span class="hljs-comment">;</span></span>
        }
    }
}

species <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>{
    string type<span class="hljs-comment"><span class="hljs-comment">; </span></span>
    rgb color &lt;- <span class="hljs-comment"><span class="hljs-comment">#gray  ;</span></span>
    
    aspect <span class="hljs-keyword"><span class="hljs-keyword">base </span></span>{
        draw <span class="hljs-keyword"><span class="hljs-keyword">shape </span></span>color: color <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    }
}

species road  {
    rgb color &lt;- <span class="hljs-comment"><span class="hljs-comment">#black ;</span></span>
    aspect <span class="hljs-keyword"><span class="hljs-keyword">base </span></span>{
        draw <span class="hljs-keyword"><span class="hljs-keyword">shape </span></span>color: color <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    }
}

species people {
    rgb color &lt;- <span class="hljs-comment"><span class="hljs-comment">#yellow ;</span></span>
    
    aspect <span class="hljs-keyword"><span class="hljs-keyword">base </span></span>{
        draw circle(<span class="hljs-number"><span class="hljs-number">10</span></span>) color: color<span class="hljs-comment"><span class="hljs-comment">;</span></span>
    }
}

experiment road_traffic type: gui {
    parameter <span class="hljs-string"><span class="hljs-string">"Shapefile for the buildings:"</span></span> var: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_buildings </span></span>category: <span class="hljs-string"><span class="hljs-string">"GIS"</span></span> <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    parameter <span class="hljs-string"><span class="hljs-string">"Shapefile for the roads:"</span></span> var: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_roads </span></span>category: <span class="hljs-string"><span class="hljs-string">"GIS"</span></span> <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    parameter <span class="hljs-string"><span class="hljs-string">"Shapefile for the bounds:"</span></span> var: <span class="hljs-keyword"><span class="hljs-keyword">shape_file_bounds </span></span>category: <span class="hljs-string"><span class="hljs-string">"GIS"</span></span> <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    parameter <span class="hljs-string"><span class="hljs-string">"Number of people agents"</span></span> var: nb_people category: <span class="hljs-string"><span class="hljs-string">"People"</span></span> <span class="hljs-comment"><span class="hljs-comment">;</span></span>
    
    output {
        <span class="hljs-keyword"><span class="hljs-keyword">display </span></span>city_display type:opengl {
            species <span class="hljs-keyword"><span class="hljs-keyword">building </span></span>aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
            species road aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
            species people aspect: <span class="hljs-keyword"><span class="hljs-keyword">base </span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span>
        }
    }
}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>