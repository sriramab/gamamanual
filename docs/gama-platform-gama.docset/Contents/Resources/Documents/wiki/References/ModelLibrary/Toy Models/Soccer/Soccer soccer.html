<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Toy Models/Soccer/Soccer soccer --><head><meta charset="utf-8"><title>Soccer soccer</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="soccer-soccer">Soccer soccer</h1>
<h1 id="soccer-game">Soccer Game</h1>
<p><em>Author : Julien</em></p>
<p>This model shows how can we make an easy simulation of collective games, such as soccer. 
Each player have an offensive and a defensive position, and a behavior associated. Each player of the defensive team can either search to catch the ball or mark an other player (offensive player) according to his defensive position.
Each player of the offensive team can either run to its offensive place (when he does not have the ball), run with the balloon / pass the ball / try to score a goal (when he has the ball). By changing the different parameters, you can see the concequences in real time. </p>
<p>Code of the model : </p>
<pre><code class="hljs zephir">
model soccer

<span class="hljs-keyword">global</span> {
    geometry shape &lt;- rectangle(<span class="hljs-number">120</span><span class="hljs-comment">#m,90#m);</span>
    <span class="hljs-keyword">float</span> red_players_speed &lt;- <span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">float</span> blue_players_speed &lt;- <span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">float</span> red_size_play_area &lt;- <span class="hljs-number">30.0</span> min:<span class="hljs-number">1.0</span> max:<span class="hljs-number">100.0</span>;
    <span class="hljs-keyword">float</span> blue_size_play_area &lt;- <span class="hljs-number">30.0</span> min: <span class="hljs-number">1.0</span> max:<span class="hljs-number">100.0</span>;
    <span class="hljs-keyword">float</span> previous_red_size_play_area &lt;- red_size_play_area; <span class="hljs-comment">// just to check if the parameter value has been changed</span>
    <span class="hljs-keyword">float</span> previous_blue_size_play_area &lt;- blue_size_play_area; <span class="hljs-comment">// just to check if the parameter value has been changed</span>
    <span class="hljs-keyword">float</span> red_collective_play &lt;- <span class="hljs-number">0.5</span> min:<span class="hljs-number">0.0</span> max:<span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">float</span> blue_collective_play &lt;- <span class="hljs-number">0.5</span> min:<span class="hljs-number">0.0</span> max:<span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">float</span> red_recuperation_ability &lt;- <span class="hljs-number">0.5</span> min:<span class="hljs-number">0.0</span> max:<span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">float</span> blue_recuperation_ability &lt;- <span class="hljs-number">0.5</span> min:<span class="hljs-number">0.0</span> max:<span class="hljs-number">1.0</span>;
    
    <span class="hljs-keyword">int</span> red_score &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> red_possession &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> nb_red_pass &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> nb_red_pass_succeed &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> nb_red_interception &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> blue_score &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> blue_possession &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> nb_blue_pass &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> nb_blue_pass_succeed &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> nb_blue_interception &lt;- <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">bool</span> show_status &lt;- <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">bool</span> show_area &lt;- <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">bool</span> show_marked_player &lt;- <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">bool</span> show_ball_indicator &lt;- <span class="hljs-keyword">false</span>;
    
    <span class="hljs-keyword">bool</span> play_with_offside &lt;- <span class="hljs-keyword">true</span>;
    
    <span class="hljs-keyword">list</span>&lt;point&gt; bluePlayerPosition &lt;- [{<span class="hljs-number">8</span>,<span class="hljs-number">10</span>}, {<span class="hljs-number">8</span>,<span class="hljs-number">80</span>}, {<span class="hljs-number">10</span>,<span class="hljs-number">30</span>}, {<span class="hljs-number">10</span>,<span class="hljs-number">60</span>},
        {<span class="hljs-number">30</span>,<span class="hljs-number">25</span>}, {<span class="hljs-number">28</span>,<span class="hljs-number">45</span>}, {<span class="hljs-number">30</span>,<span class="hljs-number">65</span>},
        {<span class="hljs-number">50</span>,<span class="hljs-number">25</span>}, {<span class="hljs-number">50</span>,<span class="hljs-number">65</span>}, {<span class="hljs-number">55</span>,<span class="hljs-number">45</span>}
    ];
    
    <span class="hljs-keyword">list</span>&lt;point&gt; redPlayerPosition &lt;- [{<span class="hljs-number">120</span><span class="hljs-number">-8</span>,<span class="hljs-number">10</span>}, {<span class="hljs-number">120</span><span class="hljs-number">-8</span>,<span class="hljs-number">80</span>}, {<span class="hljs-number">120</span><span class="hljs-number">-10</span>,<span class="hljs-number">30</span>}, {<span class="hljs-number">120</span><span class="hljs-number">-10</span>,<span class="hljs-number">60</span>},
        {<span class="hljs-number">120</span><span class="hljs-number">-30</span>,<span class="hljs-number">25</span>}, {<span class="hljs-number">120</span><span class="hljs-number">-28</span>,<span class="hljs-number">45</span>}, {<span class="hljs-number">120</span><span class="hljs-number">-30</span>,<span class="hljs-number">65</span>},
        {<span class="hljs-number">120</span><span class="hljs-number">-50</span>,<span class="hljs-number">25</span>}, {<span class="hljs-number">120</span><span class="hljs-number">-50</span>,<span class="hljs-number">65</span>}, {<span class="hljs-number">120</span><span class="hljs-number">-55</span>,<span class="hljs-number">45</span>}
    ];
    
    ball ball_agent;
    player closest_red_player_from_the_ball;
    player closest_blue_player_from_the_ball;
    player called_player;
    string team_possession &lt;- <span class="hljs-string">""</span>;
    <span class="hljs-keyword">float</span> blue_offside_pos &lt;- <span class="hljs-number">120.0</span>;
    <span class="hljs-keyword">float</span> red_offside_pos &lt;- <span class="hljs-number">0.0</span>;
    
    init {
        loop pos over:redPlayerPosition {
            create player with:[team::<span class="hljs-string">"red"</span>, location::pos];
        }
        loop pos over:bluePlayerPosition {
            create player with:[team::<span class="hljs-string">"blue"</span>, location::pos];
        }
        create ball with:[location::location] returns:ball_agt;
        ball_agent&lt;-ball_agt at <span class="hljs-number">0</span>;
        create goal with:[location::{<span class="hljs-number">0</span>,location.y}, team::<span class="hljs-string">"blue"</span>];
        create goal with:[location::{<span class="hljs-number">120</span>,location.y}, team::<span class="hljs-string">"red"</span>];
    }
    
    reflex update {
        <span class="hljs-keyword">float</span> shortest_distance &lt;- <span class="hljs-number">100.0</span>;
        <span class="hljs-keyword">float</span> offside_pos &lt;- <span class="hljs-number">0.0</span>;
        ask player where (each.team = <span class="hljs-string">"red"</span>) {
            <span class="hljs-keyword">if</span> (distance_to_ball &lt; shortest_distance <span class="hljs-keyword">and</span> inactivity_time=<span class="hljs-number">0</span>) {
                closest_red_player_from_the_ball &lt;- <span class="hljs-keyword">self</span>;
                shortest_distance &lt;- distance_to_ball;
            }
            <span class="hljs-keyword">if</span> (location.x &gt; offside_pos) {
                offside_pos &lt;- location.x;
                red_offside_pos &lt;- offside_pos;
            }
        }
        <span class="hljs-keyword">if</span> (not play_with_offside) {
            red_offside_pos &lt;- <span class="hljs-number">120.0</span>;
        }
        
        shortest_distance &lt;- <span class="hljs-number">100.0</span>;
        offside_pos &lt;- <span class="hljs-number">100.0</span>;
        ask player where (each.team = <span class="hljs-string">"blue"</span>) {
            <span class="hljs-keyword">if</span> (distance_to_ball &lt; shortest_distance <span class="hljs-keyword">and</span> inactivity_time=<span class="hljs-number">0</span>) {
                closest_blue_player_from_the_ball &lt;- <span class="hljs-keyword">self</span>;
                shortest_distance &lt;- distance_to_ball;
            }
            <span class="hljs-keyword">if</span> (location.x &lt; offside_pos) {
                offside_pos &lt;- location.x;
                blue_offside_pos &lt;- offside_pos;
            }
        }
        <span class="hljs-keyword">if</span> (not play_with_offside) {
            blue_offside_pos &lt;- <span class="hljs-number">0.0</span>;
        }
        
        <span class="hljs-keyword">if</span> (previous_red_size_play_area != red_size_play_area) {
            ask area where (each.team = <span class="hljs-string">"red"</span>) {
                <span class="hljs-keyword">do</span> update_size;
            }
            previous_red_size_play_area &lt;- red_size_play_area;
        }
        <span class="hljs-keyword">if</span> (previous_blue_size_play_area != blue_size_play_area) {
            ask area where (each.team = <span class="hljs-string">"blue"</span>) {
                <span class="hljs-keyword">do</span> update_size;
            }
            previous_blue_size_play_area &lt;- blue_size_play_area;
        }
        <span class="hljs-keyword">if</span> (team_possession = <span class="hljs-string">"blue"</span>) {
            blue_possession &lt;- blue_possession + <span class="hljs-number">1</span>;
        }
        <span class="hljs-keyword">if</span> (team_possession = <span class="hljs-string">"red"</span>) {
            red_possession &lt;- red_possession + <span class="hljs-number">1</span>;
        }
    }
    
    action reinit_phase {
        ask player {
            location &lt;- init_pos;
            previous_pos &lt;- init_pos;
        }
        ball_agent.location &lt;- location;
        ball_agent.destination &lt;- location;
        ball_agent.speed &lt;- <span class="hljs-number">0.0</span>;
    }
}

species player skills:[moving] {
    string team &lt;- <span class="hljs-string">""</span>; <span class="hljs-comment">// value : "blue" (left side) or "red" (right side)</span>
    <span class="hljs-keyword">bool</span> possess_ball &lt;- <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">int</span> inactivity_time &lt;- <span class="hljs-number">0</span> update:(inactivity_time&lt;=<span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : inactivity_time<span class="hljs-number">-1</span>;
    <span class="hljs-keyword">int</span> seed &lt;- rnd(<span class="hljs-number">100</span>);
    point init_pos;
    point previous_pos;
    
    <span class="hljs-comment">// strategy</span>
    area defensive_pos;
    area offensive_pos;
    player marked_player;
    <span class="hljs-keyword">float</span> collective_mark &lt;- <span class="hljs-number">0.5</span> update:(team=<span class="hljs-string">"red"</span>) ? red_collective_play : blue_collective_play;
    <span class="hljs-keyword">float</span> recuperation_mark &lt;- <span class="hljs-number">0.5</span> update:(team=<span class="hljs-string">"red"</span>) ? red_recuperation_ability : blue_recuperation_ability;
    
    string status &lt;- <span class="hljs-string">""</span>;
    
    <span class="hljs-comment">// moving attributes</span>
    <span class="hljs-keyword">float</span> running_speed_without_ball &lt;- <span class="hljs-number">0.8</span> update:(team=<span class="hljs-string">"red"</span>) ? red_players_speed*<span class="hljs-number">0.8</span> : blue_players_speed*<span class="hljs-number">0.8</span>;
    <span class="hljs-keyword">float</span> running_speed_with_ball &lt;- <span class="hljs-number">0.6</span> update:(team=<span class="hljs-string">"red"</span>) ? red_players_speed*<span class="hljs-number">0.5</span> : blue_players_speed*<span class="hljs-number">0.5</span>;
    <span class="hljs-keyword">float</span> speed &lt;- <span class="hljs-number">0.0</span> max:<span class="hljs-number">1.2</span>;
    point velocity &lt;- {<span class="hljs-number">0</span>,<span class="hljs-number">0</span>};
    
    <span class="hljs-keyword">float</span> distance_to_closest_ennemy &lt;- <span class="hljs-number">100.0</span>;
    <span class="hljs-keyword">float</span> distance_to_ennemy_goal &lt;- <span class="hljs-number">100.0</span> update:<span class="hljs-keyword">self</span> distance_to ( (goal where (each.team != team)) at <span class="hljs-number">0</span>);
    <span class="hljs-keyword">float</span> distance_to_ball &lt;- <span class="hljs-number">100.0</span> update:<span class="hljs-keyword">self</span> distance_to ball_agent;
    
    init {
        init_pos &lt;- location;
        previous_pos &lt;- location;
        create area with:[location::init_pos, team::self.team, position::init_pos] returns:def_pos;
        defensive_pos &lt;- def_pos at <span class="hljs-number">0</span>;
        point offensivePos &lt;- {(team=<span class="hljs-string">"red"</span>) ? init_pos.x<span class="hljs-number">-60</span> : init_pos.x+<span class="hljs-number">60</span>,init_pos.y};
        create area with:[location::offensivePos, team::self.team, position::offensivePos] returns:off_pos;
        offensive_pos &lt;- off_pos at <span class="hljs-number">0</span>;
    }
    
    reflex update_status {
        distance_to_closest_ennemy &lt;- <span class="hljs-number">100.0</span>;
        loop pl over:player where (each.team != team) {
            <span class="hljs-keyword">float</span> distance_to_ennemy &lt;- <span class="hljs-keyword">self</span> distance_to pl;
            <span class="hljs-keyword">if</span> (distance_to_ennemy &lt; distance_to_closest_ennemy) {
                distance_to_closest_ennemy &lt;- distance_to_ennemy;
            }
        }
    }
    
    reflex defensive_behavior when:team_possession != team {
        <span class="hljs-comment">// the ball is not possessed by the team.</span>
        <span class="hljs-keyword">do</span> apply_inertia;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span> = closest_red_player_from_the_ball <span class="hljs-keyword">or</span> <span class="hljs-keyword">self</span> = closest_blue_player_from_the_ball) {
            <span class="hljs-keyword">do</span> run_to_ball;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">do</span> defensive_move;
        }
    }
    
    reflex offensive_behavior when:team_possession = team {
        <span class="hljs-keyword">do</span> apply_inertia;
        <span class="hljs-keyword">if</span> (possess_ball) {
            <span class="hljs-keyword">do</span> run_with_ball;
            <span class="hljs-keyword">if</span> (distance_to_ennemy_goal &lt; <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> flip(<span class="hljs-number">1</span>/(distance_to_ennemy_goal*distance_to_ennemy_goal/<span class="hljs-number">10</span>+<span class="hljs-number">1</span>))) {
                <span class="hljs-comment">// shoot !</span>
                <span class="hljs-keyword">do</span> kick_ball_to_goal;
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// pass !</span>
                <span class="hljs-keyword">if</span> (distance_to_closest_ennemy &lt; <span class="hljs-number">5</span>) {
                    <span class="hljs-keyword">if</span> (flip(collective_mark)) {
                        <span class="hljs-keyword">do</span> pass_the_ball;
                    }
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> flip(collective_mark/<span class="hljs-number">50</span>) {
                    <span class="hljs-keyword">do</span> pass_the_ball;
                }
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ball_agent.belong_to_team = <span class="hljs-string">""</span> <span class="hljs-keyword">and</span>
            (<span class="hljs-keyword">self</span> = closest_red_player_from_the_ball <span class="hljs-keyword">or</span> <span class="hljs-keyword">self</span> = closest_blue_player_from_the_ball
            <span class="hljs-keyword">or</span> <span class="hljs-keyword">self</span> = called_player)
        ) {
            <span class="hljs-keyword">do</span> run_to_ball;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">do</span> offensive_move;
        }
    }
    
    reflex choose_player_to_mark when:(cycle mod <span class="hljs-number">20</span>=seed <span class="hljs-keyword">or</span> cycle=<span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> ( not <span class="hljs-keyword">empty</span>(player where(each.offensive_pos intersects defensive_pos)) ) {
            marked_player &lt;- <span class="hljs-number">1</span> among (player where((each.offensive_pos intersects defensive_pos) <span class="hljs-keyword">and</span> (each.team != team))) at <span class="hljs-number">0</span>;
        }
    }
    
    action apply_inertia {
        point prev_pos &lt;- location;
        point inertia_vect &lt;- {(location.x-previous_pos.x)*<span class="hljs-number">0.8</span>,(location.y-previous_pos.y)*<span class="hljs-number">0.8</span>};
        <span class="hljs-keyword">float</span> max_inertia &lt;- running_speed_without_ball;
        <span class="hljs-keyword">if</span> (norm(inertia_vect) &gt; max_inertia) {
            <span class="hljs-keyword">float</span> inertia_x &lt;-  sqrt(abs(max_inertia*max_inertia-inertia_vect.y*inertia_vect.y));
            <span class="hljs-keyword">float</span> inertia_y &lt;-  sqrt(abs(max_inertia*max_inertia-inertia_vect.x*inertia_vect.x));
            inertia_x &lt;- (inertia_vect.x &lt; <span class="hljs-number">0</span>) ? -inertia_x : inertia_x;
            inertia_y &lt;- (inertia_vect.y &lt; <span class="hljs-number">0</span>) ? -inertia_y : inertia_y;
            inertia_vect &lt;- {inertia_x,inertia_y};
        }
        location &lt;- location + inertia_vect;
        previous_pos &lt;- prev_pos;
    }
    
    action run_to_ball {
        point targetPos;
        <span class="hljs-keyword">if</span> (ball_agent.ball_direction intersects circle(<span class="hljs-number">1</span>)) {
            targetPos &lt;- ball_agent.location;
        }
        <span class="hljs-keyword">else</span> {
            targetPos &lt;- (ball_agent.ball_direction closest_points_with <span class="hljs-keyword">self</span>) at <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> with:[target::targetPos, speed::running_speed_without_ball];
        
        status &lt;- <span class="hljs-string">"run to the ball"</span>;
        
        <span class="hljs-comment">// if close enough, catch the ball</span>
        <span class="hljs-keyword">if</span> (location distance_to ball_agent.location &lt; <span class="hljs-number">1.5</span><span class="hljs-comment">#m) {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span> = called_player) {
                <span class="hljs-keyword">do</span> take_ball;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ball_agent.belong_to_team = <span class="hljs-string">""</span>) {
                <span class="hljs-keyword">if</span> flip(<span class="hljs-number">1</span>/(ball_agent.speed*recuperation_mark+<span class="hljs-number">1</span>)) {
                    <span class="hljs-keyword">do</span> take_ball;
                }
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (team_possession = team) {
                    <span class="hljs-comment">// result of a long pass for instance</span>
                    <span class="hljs-keyword">if</span> (flip(recuperation_mark*<span class="hljs-number">1.5</span>)) {
                        <span class="hljs-keyword">do</span> take_ball;
                    }
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// interception of the ball</span>
                    <span class="hljs-keyword">if</span> (flip(recuperation_mark*<span class="hljs-number">0.8</span>)) {
                        <span class="hljs-keyword">do</span> take_ball;
                    }
                }
            }
        }
    }
    
    action run_with_ball {
        status &lt;- <span class="hljs-string">"run with the ball"</span>;
        point goal_pos;
        ask goal {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.team != myself.team) {
                goal_pos &lt;- location;
            }
        }
        <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> with:[target::goal_pos, speed::running_speed_with_ball];
        ball_agent.location &lt;- location;
    }
    
    action offensive_move {
        <span class="hljs-comment">// try to reach an offensive postion</span>
        point target_location;
        geometry possible_pos &lt;- (team=<span class="hljs-string">"red"</span>) ? world inter (rectangle({blue_offside_pos,<span class="hljs-number">0</span>},{<span class="hljs-number">120</span>,<span class="hljs-number">90</span>}))
        : world inter (rectangle({<span class="hljs-number">0</span>,<span class="hljs-number">0</span>},{red_offside_pos,<span class="hljs-number">90</span>}));
        
        
        <span class="hljs-comment">// check if the player is in the field</span>
        <span class="hljs-keyword">if</span> (location.y &lt; <span class="hljs-number">0</span>) {
            target_location &lt;- {location.x,<span class="hljs-number">90</span>};
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (location.y &gt; <span class="hljs-number">90</span>) {
            target_location &lt;- {location.x,<span class="hljs-number">0</span>};
        }
        <span class="hljs-comment">// check if the player is in offside position</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( (location.x &gt; red_offside_pos <span class="hljs-keyword">and</span> team = <span class="hljs-string">"blue"</span>) <span class="hljs-keyword">or</span> (location.x &lt; blue_offside_pos <span class="hljs-keyword">and</span> team = <span class="hljs-string">"red"</span>)) {
            target_location &lt;- (team=<span class="hljs-string">"red"</span>) ? {<span class="hljs-number">120</span>,location.y} : {<span class="hljs-number">0</span>,location.y};
            status &lt;- <span class="hljs-string">"run to a non offside position"</span>;
        }
        <span class="hljs-keyword">else</span> {
            status &lt;- <span class="hljs-string">"run to a offensive place"</span>;
            <span class="hljs-keyword">if</span> (not (possible_pos intersects offensive_pos)) {
                target_location &lt;- (team=<span class="hljs-string">"red"</span>) ? {blue_offside_pos,location.y} : {red_offside_pos,location.y};
            }
            <span class="hljs-keyword">else</span>
            {
                target_location &lt;- any_location_in(offensive_pos inter possible_pos);
            }
        }
        <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> target:target_location speed:running_speed_without_ball;
    }
    
    action defensive_move {
        <span class="hljs-comment">// try to mark an ennemy player</span>
        status &lt;- <span class="hljs-string">"mark ennemy player"</span>;
        <span class="hljs-keyword">if</span> (not (marked_player = nil)) {
            <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> with:[target::marked_player.location+((team=<span class="hljs-string">"red"</span>)?{<span class="hljs-number">2</span>+rnd(<span class="hljs-number">5.0</span>),rnd(<span class="hljs-number">2.0</span>)<span class="hljs-number">-1</span>} : {<span class="hljs-number">-2</span>-rnd(<span class="hljs-number">5.0</span>),rnd(<span class="hljs-number">2.0</span>)<span class="hljs-number">-1</span>}), speed::running_speed_without_ball];
        }
    }
    
    action kick_ball_to_goal {
        <span class="hljs-keyword">do</span> loose_ball;
        ask ball_agent {
            <span class="hljs-keyword">do</span> shooted speed_atr:<span class="hljs-number">4.0</span> target_position:((goal where (each.team != myself.team)) at <span class="hljs-number">0</span>).location;
        }
        inactivity_time &lt;- <span class="hljs-number">20</span>;
    }
    
    action pass_the_ball {
        <span class="hljs-keyword">float</span> wisest_choice_mark &lt;- <span class="hljs-number">-100.0</span>;
        player wisest_target;
        ask player  where(each.team = team <span class="hljs-keyword">and</span> each != <span class="hljs-keyword">self</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">self</span> distance_to each &gt; <span class="hljs-number">15</span>)) {
            <span class="hljs-keyword">int</span> number_of_ennemies_on_range &lt;- length(player at_distance <span class="hljs-number">5</span> where (each.team != myself.team));
            <span class="hljs-keyword">float</span> wise_choice_mark &lt;- <span class="hljs-number">100</span>-distance_to_ball+number_of_ennemies_on_range*<span class="hljs-number">10</span><span class="hljs-number">-2</span>*distance_to_ennemy_goal;
            <span class="hljs-keyword">if</span> (wise_choice_mark &gt; wisest_choice_mark) {
                wisest_target &lt;- <span class="hljs-keyword">self</span>;
                wisest_choice_mark &lt;- wise_choice_mark;
            }
        }
        <span class="hljs-keyword">if</span> (wisest_choice_mark &gt; <span class="hljs-number">-100.0</span>) {
            <span class="hljs-comment">// a target has been found</span>
            <span class="hljs-keyword">do</span> loose_ball;
            ask ball_agent {
                <span class="hljs-keyword">do</span> shooted target_position:wisest_target.location speed_atr:wisest_target.distance_to_ball/<span class="hljs-number">8</span>;
            }
            called_player &lt;- wisest_target;
            inactivity_time &lt;- <span class="hljs-number">20</span>;
            <span class="hljs-keyword">if</span> (team = <span class="hljs-string">"red"</span>) {nb_red_pass &lt;- nb_red_pass+<span class="hljs-number">1</span>;}
            <span class="hljs-keyword">else</span> {nb_blue_pass &lt;- nb_blue_pass+<span class="hljs-number">1</span>;}
        }
    }
    
    action take_ball {
        <span class="hljs-keyword">if</span> (ball_agent.belong_to_team != <span class="hljs-string">""</span> <span class="hljs-keyword">and</span> ball_agent.belong_to_team != team) {
            ask ball_agent.belong_to_player {
                <span class="hljs-keyword">do</span> loose_ball;
            }
        }
        team_possession &lt;- team;
        possess_ball &lt;- <span class="hljs-keyword">true</span>;
        ball_agent.belong_to_team &lt;- team;
        ball_agent.belong_to_player &lt;- <span class="hljs-keyword">self</span>;
        ball_agent.speed &lt;- <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span> = called_player) {
            <span class="hljs-keyword">if</span> (team = <span class="hljs-string">"red"</span>) {nb_red_pass_succeed &lt;- nb_red_pass_succeed+<span class="hljs-number">1</span>;}
            <span class="hljs-keyword">else</span> {nb_blue_pass_succeed &lt;- nb_blue_pass_succeed+<span class="hljs-number">1</span>;}
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (team = <span class="hljs-string">"red"</span>) {nb_red_interception &lt;- nb_red_interception+<span class="hljs-number">1</span>;}
            <span class="hljs-keyword">else</span> {nb_blue_interception &lt;- nb_blue_interception+<span class="hljs-number">1</span>;}
        }
        called_player &lt;- nil;
    }
    
    action loose_ball {
        possess_ball &lt;- <span class="hljs-keyword">false</span>;
        ball_agent.belong_to_team &lt;- <span class="hljs-string">""</span>;
    }
    
    aspect base {
        draw circle(<span class="hljs-number">1</span>) color:(team=<span class="hljs-string">"red"</span>) ? <span class="hljs-comment">#red : #blue;</span>
        <span class="hljs-keyword">if</span> (show_status) {
            draw string(status);
            <span class="hljs-keyword">if</span> (marked_player != nil) {
                draw polyline([location,marked_player.location]);
            }
        }
        <span class="hljs-keyword">if</span> (marked_player != nil <span class="hljs-keyword">and</span> show_marked_player) {
            draw polyline([location,marked_player.location]) end_arrow:<span class="hljs-number">1</span> color:<span class="hljs-comment">#chartreuse;</span>
        }
    }
}

species area {
    string team &lt;- <span class="hljs-string">""</span>;
    point position;
    
    init {
        shape &lt;- ((team=<span class="hljs-string">"red"</span>) ? square(red_size_play_area) : square(blue_size_play_area)) inter world;
    }
    
    action update_size {
        location &lt;- position;
        shape &lt;- ((team=<span class="hljs-string">"red"</span>) ? square(red_size_play_area) : square(blue_size_play_area)) inter world;
    }
    
    aspect base {
        <span class="hljs-keyword">if</span> (show_area) {
            draw shape color:rgb(<span class="hljs-number">128</span>,<span class="hljs-number">128</span>,<span class="hljs-number">128</span>,<span class="hljs-number">50</span>) border:(team=<span class="hljs-string">"red"</span>) ? rgb(<span class="hljs-number">256</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">100</span>) : rgb(<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">256.0</span>,<span class="hljs-number">100</span>);
        }
    }
}

species ball skills:[moving]{
    string belong_to_team &lt;- <span class="hljs-string">""</span>;
    player belong_to_player;
    <span class="hljs-keyword">float</span> speed &lt;- <span class="hljs-number">0.0</span> update:speed*<span class="hljs-number">0.9</span>;
    <span class="hljs-keyword">list</span>&lt;point&gt; nextPlace;
    geometry ball_direction;
    reflex update {
        <span class="hljs-keyword">float</span> future_speed &lt;- speed;
        point tmpPos&lt;-location;
        loop i from:<span class="hljs-number">0</span> to:<span class="hljs-number">10</span> {
            tmpPos &lt;- {tmpPos.x+cos(heading)*speed,tmpPos.y+sin(heading)*speed};
            future_speed &lt;- future_speed*<span class="hljs-number">0.9</span>;
        }
        ball_direction &lt;- line([location,tmpPos]);
        <span class="hljs-keyword">if</span> ((location.x+cos(heading)*speed) &gt; <span class="hljs-number">120</span>) {
            blue_score &lt;- blue_score + <span class="hljs-number">1</span>;
            ask world {
                <span class="hljs-keyword">do</span> reinit_phase;
            }
        }
        <span class="hljs-keyword">if</span> ((location.x+cos(heading)*speed) &lt; <span class="hljs-number">0</span>) {
            red_score &lt;- red_score + <span class="hljs-number">1</span>;
            ask world {
                <span class="hljs-keyword">do</span> reinit_phase;
            }
        }
        <span class="hljs-keyword">do</span> wander amplitude:<span class="hljs-number">1</span>;
    }
    action shooted (point target_position, <span class="hljs-keyword">float</span> speed_atr) {
        speed &lt;- speed_atr;
        <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> target:target_position;
    }
    aspect base {
        draw circle(<span class="hljs-number">0.5</span>) color:<span class="hljs-comment">#white border:#black;</span>
        <span class="hljs-keyword">if</span> (show_ball_indicator) {
            draw ball_direction end_arrow:<span class="hljs-number">1</span> color:<span class="hljs-comment">#chartreuse;</span>
            <span class="hljs-keyword">if</span> (team_possession=<span class="hljs-string">"red"</span>) {
                draw circle(<span class="hljs-number">0.5</span>) color:<span class="hljs-comment">#darkred border:#black;</span>
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (team_possession=<span class="hljs-string">"blue"</span>) {
                draw circle(<span class="hljs-number">0.5</span>) color:<span class="hljs-comment">#darkblue border:#black;</span>
            }
        }
    }
}

species goal {
    string team &lt;- <span class="hljs-string">""</span>;
    aspect base {
        draw rectangle(<span class="hljs-number">0.1</span>,<span class="hljs-number">7.32</span>) color:<span class="hljs-comment">#black;</span>
    }
}


experiment match type:gui {
    parameter <span class="hljs-string">"blue running speed"</span> <span class="hljs-keyword">var</span>:blue_players_speed category:<span class="hljs-string">"Blue Team"</span>;
    parameter <span class="hljs-string">"red running speed"</span> <span class="hljs-keyword">var</span>:red_players_speed category:<span class="hljs-string">"Red Team"</span>;
    <span class="hljs-comment">// speed of players when they run. Note that a player which have the ball will run at 50% of his max capacity, and he will run at 80% of his max capacity if he does not have the ball.</span>
    
    parameter <span class="hljs-string">"blue collective play"</span> <span class="hljs-keyword">var</span>:blue_collective_play category:<span class="hljs-string">"Blue Team"</span>;
    parameter <span class="hljs-string">"red collective play"</span> <span class="hljs-keyword">var</span>:red_collective_play category:<span class="hljs-string">"Red Team"</span>;
    <span class="hljs-comment">// propention of giving the ball to an other player of the team. If the value is 0, the player will never pass the ball.</span>
    
    parameter <span class="hljs-string">"blue recuperation ability"</span> <span class="hljs-keyword">var</span>:blue_recuperation_ability category:<span class="hljs-string">"Blue Team"</span>;
    parameter <span class="hljs-string">"red recuperation ability"</span> <span class="hljs-keyword">var</span>:red_recuperation_ability category:<span class="hljs-string">"Red Team"</span>;
    <span class="hljs-comment">// ability to catch the ball when no player has it and when a player of the other team has it. 1 for very good hability, 0 for very poor hability.</span>
    
    parameter <span class="hljs-string">"blue play area size"</span> <span class="hljs-keyword">var</span>:blue_size_play_area category:<span class="hljs-string">"Blue Team"</span>;
    parameter <span class="hljs-string">"red play area size"</span> <span class="hljs-keyword">var</span>:red_size_play_area category:<span class="hljs-string">"Red Team"</span>;
    <span class="hljs-comment">// change the size of the area of each player. The bigger this area is, the less players will maintains their position.</span>
    
    parameter <span class="hljs-string">"display status"</span> <span class="hljs-keyword">var</span>:show_status category:<span class="hljs-string">"Display"</span>;
    <span class="hljs-comment">// displays or not the current status of the player (his intentions)</span>
    
    parameter <span class="hljs-string">"display play area"</span> <span class="hljs-keyword">var</span>:show_area category:<span class="hljs-string">"Display"</span>;
    <span class="hljs-comment">// displays or not the offensive and defensive area of each player. The bigger this area is, the less players will maintains their position.</span>
    
    parameter <span class="hljs-string">"display marked player"</span> <span class="hljs-keyword">var</span>:show_marked_player category:<span class="hljs-string">"Display"</span>;
    <span class="hljs-comment">// displays or not an arrow between the player that are marked each other.</span>
    
    parameter <span class="hljs-string">"display ball indicators"</span> <span class="hljs-keyword">var</span>:show_ball_indicator category:<span class="hljs-string">"Display"</span>;
    <span class="hljs-comment">// changes the color of the ball if the ball is possessed by the blue or the red team. Display also the direction of the ball when it has been shooted.</span>
    
    parameter <span class="hljs-string">"play with offside position"</span> <span class="hljs-keyword">var</span>:play_with_offside category:<span class="hljs-string">"Rules"</span>;
    <span class="hljs-comment">// play with or without the "offside" rule.</span>
    
    output {
        display <span class="hljs-string">"soccer_field"</span> {
            <span class="hljs-comment">// display the field.</span>
            image <span class="hljs-string">"../images/soccer_field.png"</span>;
            species player aspect:base;
            species ball aspect:base;
            species goal aspect:base;
            species area aspect:base;
            graphics <span class="hljs-string">"score_display"</span> {
                draw <span class="hljs-string">"Blue side - "</span>+string(blue_score) color:<span class="hljs-comment">#blue at: {10,5} font: font("Helvetica", 18 * #zoom, #bold) perspective:true;</span>
                draw string(red_score)+<span class="hljs-string">" - Red side"</span> color:<span class="hljs-comment">#red at: {100,5} font: font("Helvetica", 18 * #zoom, #bold) perspective:true;</span>
                <span class="hljs-keyword">if</span> (show_status) {
                    draw line([{red_offside_pos,<span class="hljs-number">0</span>},{red_offside_pos,<span class="hljs-number">90</span>}]) color:<span class="hljs-comment">#red;</span>
                    draw line([{blue_offside_pos,<span class="hljs-number">0</span>},{blue_offside_pos,<span class="hljs-number">90</span>}]) color:<span class="hljs-comment">#blue;</span>
                }
            }
        }
        display <span class="hljs-string">"match_stats"</span> {
            <span class="hljs-comment">// display some statistics about the game</span>
            chart <span class="hljs-string">"ball_possession"</span> type:pie position:{<span class="hljs-number">0</span>,<span class="hljs-number">0</span>} size:{<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>} {
                data <span class="hljs-string">"Red possession"</span> value:red_possession color:<span class="hljs-comment">#red;</span>
                data <span class="hljs-string">"Blue possession"</span> value:blue_possession color:<span class="hljs-comment">#blue;</span>
            }
            chart <span class="hljs-string">"red pass"</span> type:pie position:{<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>} size:{<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>} {
                <span class="hljs-comment">// note that a pass is said "successful" if the player that has the ball was the player called initially. A "failed pass" does not necessary means that the team have lost the ball.</span>
                    data <span class="hljs-string">"Red pass succeed"</span> value:(nb_red_pass = <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : <span class="hljs-keyword">float</span>(nb_red_pass_succeed)/<span class="hljs-keyword">float</span>(nb_red_pass) color:<span class="hljs-comment">#red;</span>
                    data <span class="hljs-string">"Red pass failed"</span> value:(nb_red_pass = <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>-<span class="hljs-keyword">float</span>(nb_red_pass_succeed)/<span class="hljs-keyword">float</span>(nb_red_pass) color:<span class="hljs-comment">#darkred;</span>
            }
            chart <span class="hljs-string">"blue pass"</span> type:pie position:{<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>} size:{<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>} {
                <span class="hljs-comment">// note that a pass is said "successful" if the player that has the ball was the player called initially. A "failed pass" does not necessary means that the team have lost the ball.</span>
                data <span class="hljs-string">"Blue pass succeed"</span> value:(nb_blue_pass = <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : <span class="hljs-keyword">float</span>(nb_blue_pass_succeed)/<span class="hljs-keyword">float</span>(nb_blue_pass) color:<span class="hljs-comment">#blue;</span>
                data <span class="hljs-string">"Blue pass failed"</span> value:(nb_blue_pass = <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>-<span class="hljs-keyword">float</span>(nb_blue_pass_succeed)/<span class="hljs-keyword">float</span>(nb_blue_pass) color:<span class="hljs-comment">#darkblue;</span>
            }
            chart <span class="hljs-string">"number pass"</span> type:series position:{<span class="hljs-number">0.5</span>,<span class="hljs-number">0</span>} size:{<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>} {
                data <span class="hljs-string">"Number pass red"</span> value:nb_red_pass color:<span class="hljs-comment">#red;</span>
                data <span class="hljs-string">"Number pass blue"</span> value:nb_blue_pass color:<span class="hljs-comment">#blue;</span>
            }
        }
    }
}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>