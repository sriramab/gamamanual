<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Features/Database Usage/Database Usage Agents to Database in PostGIS --><head><meta charset="utf-8"><title>Database Usage Agents to Database in PostGIS</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="database-usage-agents-to-database-in-postgis">Database Usage Agents to Database in PostGIS</h1>
<h1 id="agents-to-database-in-postgis">Agents to Database in PostGIS</h1>
<p><em>Author : Truong Minh Thai</em></p>
<p>init: Select data from table vnm_adm2 (Created via QGis software)  and create  agents
savetosql: Save data of agent into MySQL.
transform= true because you need to transform geometry data from Absolute(GAMA) to Gis
NOTE: You should have imported the database (spatial_DB.sql) into the MySQL server in order that the model can run properly.</p>
<p>Code of the model : </p>
<pre><code class="hljs gradle">
model agent2DB_MySQL 
  
global { 
    <span class="hljs-keyword">file</span> buildingsShp &lt;- <span class="hljs-keyword">file</span>(<span class="hljs-string">'../../includes/building.shp'</span>);
    <span class="hljs-keyword">file</span> boundsShp &lt;- <span class="hljs-keyword">file</span>(<span class="hljs-string">'../../includes/bounds.shp'</span>);
    geometry shape &lt;- envelope(boundsShp);
     
    map&lt;string,string&gt; PARAMS &lt;-  [<span class="hljs-comment">//'srid'::'4326', // optinal</span>
                                   <span class="hljs-string">'host'</span>::<span class="hljs-string">'localhost'</span>,<span class="hljs-string">'dbtype'</span>::<span class="hljs-string">'Postgres'</span>,<span class="hljs-string">'database'</span>::<span class="hljs-string">'spatial_DB'</span>,
                                   <span class="hljs-string">'port'</span>::<span class="hljs-string">'5433'</span>,<span class="hljs-string">'user'</span>::<span class="hljs-string">'postgres'</span>,<span class="hljs-string">'passwd'</span>::<span class="hljs-string">'tmt'</span>];

    init {
        create buildings <span class="hljs-keyword">from</span>: buildingsShp with: [type::string(<span class="hljs-keyword">read</span> (<span class="hljs-string">'NATURE'</span>))];
        create bounds <span class="hljs-keyword">from</span>: boundsShp;
        
        create DB_Accessor
        {           
            <span class="hljs-keyword">do</span> executeUpdate params: PARAMS updateComm: <span class="hljs-string">"DELETE FROM buildings"</span>;    
            <span class="hljs-keyword">do</span> executeUpdate params: PARAMS updateComm: <span class="hljs-string">"DELETE FROM bounds"</span>;
        }
        <span class="hljs-keyword">write</span> <span class="hljs-string">"Click on &lt;&lt;Step&gt;&gt; button to save data of agents to DB"</span>;       
    }
}   
  
species DB_Accessor skills: [SQLSKILL] ;   

species bounds {
    reflex printdata{
         <span class="hljs-keyword">write</span> <span class="hljs-string">" name : "</span> + (name) ;
    }
    
    reflex savetosql{  <span class="hljs-comment">// save data into Postgres</span>
        <span class="hljs-keyword">write</span> <span class="hljs-string">"begin"</span>+ name;
        ask DB_Accessor {
            <span class="hljs-keyword">do</span> insert params: PARAMS <span class="hljs-keyword">into</span>: <span class="hljs-string">"bounds"</span>
                      columns: [<span class="hljs-string">"geom"</span>]
                      values: [myself.shape];
        }
        <span class="hljs-keyword">write</span> <span class="hljs-string">"finish "</span>+ name;
    }       
}

species buildings {
    string type;
    
    reflex printdata{
        <span class="hljs-keyword">write</span> <span class="hljs-string">" name : "</span> + (name) + <span class="hljs-string">"; type: "</span> + (type) + <span class="hljs-string">"shape:"</span> + shape;
    }
    
    reflex savetosql{  <span class="hljs-comment">// save data into Postgres</span>
        <span class="hljs-keyword">write</span> <span class="hljs-string">"begin"</span>+ name;
        ask DB_Accessor {
            <span class="hljs-keyword">do</span> insert params: PARAMS <span class="hljs-keyword">into</span>: <span class="hljs-string">"buildings"</span>
                      columns: [<span class="hljs-string">"name"</span>, <span class="hljs-string">"type"</span>,<span class="hljs-string">"geom"</span>]
                      values: [myself.name,myself.type,myself.shape];
        }
        <span class="hljs-keyword">write</span> <span class="hljs-string">"finish "</span>+ name;
    }   
    
    aspect <span class="hljs-keyword">default</span> {
        draw shape color: #gray ;
    }
}   

experiment default_expr type: gui {
    output {
        
        display GlobalView {
            species buildings aspect: <span class="hljs-keyword">default</span>;
        }
    }
}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>