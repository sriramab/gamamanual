<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Additionnal Plugins/FIPA Skill/FIPA Skill FIPA Request (4) --><head><meta charset="utf-8"><title>FIPA Skill FIPA Request (4)</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="fipa-skill-fipa-request-4">FIPA Skill FIPA Request (4)</h1>
<h1 id="fipa-request-4">FIPA Request (4)</h1>
<p>This model demontrates a usecase of the FIPA Request interaction protocol. </p>
<ul>
<li><p>(Please see <a href="http://www.fipa.org/specs/fipa00026/index.html">http://www.fipa.org/specs/fipa00026/index.html</a> for the detail description of this protocol).</p>
</li>
<li><p>The Initiator agent begins the 'fipa-request' conversation/intaction protocol by sending a 'request' </p>
</li>
<li><p>message to the Participant agent with 'go sleeping' as content.</p>
</li>
<li><p>On receiving a 'request' message, the Participant agent replies with an 'inform' message. </p>
</li>
<li>According to the specification of the FIPA Requestion interaction protocol, the next possible messages </li>
<li>after receiving a 'request' message are either 'refuse' message or 'agree' message. </li>
<li>Hence replying with an 'inform' message upon receiving a 'request' message violates the protocol specification. </li>
<li>GAMA will hence raise a GamaRuntimeException. </li>
<li>A conversation is automatically ended in case of GamaRuntimeException raised. Hence this conversation ends.</li>
</ul>
<p>Code of the model : </p>
<pre><code class="hljs groovy">model fipa_request_4

global {
    Participant p;
    
    init {
        create Initiator;
        create Participant <span class="hljs-string">returns:</span> ps;
        
        p &lt;- ps at <span class="hljs-number">0</span>;
        
        write <span class="hljs-string">'Step the simulation to observe the outcome in the console'</span>;
    }
}

species Initiator <span class="hljs-string">skills:</span> [fipa] {
    reflex print_debug_infor {
        write name + <span class="hljs-string">' with conversations: '</span> + (string(conversations)) + <span class="hljs-string">'; messages: '</span> + (string(mailbox));
    }
    
    reflex send_request <span class="hljs-string">when:</span> (time = <span class="hljs-number">1</span>) {
        write <span class="hljs-string">'send message'</span>;
        do start_conversation <span class="hljs-string">with:</span> [ <span class="hljs-string">to :</span>: [p], <span class="hljs-string">protocol :</span>: <span class="hljs-string">'fipa-request'</span>, <span class="hljs-string">performative :</span>: <span class="hljs-string">'request'</span>, <span class="hljs-string">contents :</span>: [<span class="hljs-string">'go sleeping'</span>] ];
    }
    
    reflex read_refuse_message <span class="hljs-string">when:</span> !(empty(refuses)) {
        write <span class="hljs-string">'read refuse messages'</span>;
        loop r <span class="hljs-string">over:</span> refuses {
            write <span class="hljs-string">'refuse message with content: '</span> + string(r.contents);
        }
    }
}

species Participant <span class="hljs-string">skills:</span> [fipa] {
    reflex print_debug_infor {
        write name + <span class="hljs-string">' with conversations: '</span> + (string(conversations)) + <span class="hljs-string">'; messages: '</span> + (string(mailbox));
    }

    reflex reply_messages <span class="hljs-string">when:</span> (!empty(mailbox)) {
        write name + <span class="hljs-string">' sends an inform message'</span>;
        
        
        write <span class="hljs-string">'A GamaRuntimeException is raised to inform that the message\'s performative doesn\'t respect the \'request\' interaction protocol\' specification'</span>;
        do inform <span class="hljs-string">with:</span> [ <span class="hljs-string">message :</span>: (mailbox at <span class="hljs-number">0</span>), <span class="hljs-string">contents :</span>: [<span class="hljs-string">'I don\'t want'</span>] ]; <span class="hljs-comment">// Attention: note that GAMA will raise an exception because an 'inform' message is not appropriate here.</span>
    }
}


experiment test_request_interaction_protocol <span class="hljs-string">type:</span> gui {}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>