<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Toy Models/Vote/Vote Vote --><head><meta charset="utf-8"><title>Vote Vote</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="vote-vote">Vote Vote</h1>
<h1 id="vote">vote</h1>
<p>_Author : MAPS TEAM (Frederic Amblard, Thomas Louail, Romain Reulier, Paul Salze et Patrick Taillandier) _</p>
<p>Modeling of an election</p>
<p>Code of the model : </p>
<pre><code class="hljs zephir"> 
model vote

<span class="hljs-keyword">global</span> {
    <span class="hljs-comment">//Shape of the environment</span>
    geometry shape &lt;- rectangle({<span class="hljs-number">200</span>, <span class="hljs-number">200</span>});
    
    <span class="hljs-comment">//Number of electors</span>
    <span class="hljs-keyword">int</span> nb_electors &lt;- <span class="hljs-number">1500</span>;
    <span class="hljs-comment">//Number of candidates</span>
    <span class="hljs-keyword">int</span> nb_candidates &lt;- <span class="hljs-number">7</span>;
    <span class="hljs-comment">//Weight of each candidates</span>
    <span class="hljs-keyword">int</span> weight_candidates &lt;- <span class="hljs-number">50</span>;
    <span class="hljs-comment">//Threshold for the attraction candidates</span>
    <span class="hljs-keyword">int</span> threshold_attraction_candidates &lt;- <span class="hljs-number">80</span>;
    <span class="hljs-comment">//Threshold for the repulsion candidates</span>
    <span class="hljs-keyword">int</span> threshold_repulsion_candidates &lt;- <span class="hljs-number">200</span>;
    <span class="hljs-comment">//Threshold for the attraction electors</span>
    <span class="hljs-keyword">int</span> threshold_attraction_electors &lt;- <span class="hljs-number">20</span>;
    
    <span class="hljs-comment">//Distance traveled</span>
    <span class="hljs-keyword">float</span> distance_traveled &lt;- <span class="hljs-number">7.0</span>;
    <span class="hljs-comment">//Distribution of the electors</span>
    string distribution_electors &lt;- <span class="hljs-string">"Uniform"</span> among: [<span class="hljs-string">"Uniform"</span>, <span class="hljs-string">"Normal"</span>];
    <span class="hljs-comment">//Distribution of candidates</span>
    string distribution_candidates &lt;- <span class="hljs-string">"Polygon"</span> among: [<span class="hljs-string">"Random"</span>, <span class="hljs-string">"Polygon"</span>, <span class="hljs-string">"Line"</span>, <span class="hljs-string">"Diagonal"</span>];
    <span class="hljs-comment">//Strategy of the candidates</span>
    string strategy_candidates &lt;- <span class="hljs-string">"No strategy"</span> among: [<span class="hljs-string">"No strategy"</span>, <span class="hljs-string">"Search electors"</span>, <span class="hljs-string">"Distinction"</span>, <span class="hljs-string">"Group"</span>, <span class="hljs-string">"Go closer to the best"</span>,<span class="hljs-string">"Random"</span> ];
    <span class="hljs-comment">//Count of max group</span>
    <span class="hljs-keyword">int</span> cpt_Group_max &lt;- <span class="hljs-number">5</span>;
    <span class="hljs-comment">//Count  of group</span>
    <span class="hljs-keyword">int</span> cpt_Group &lt;- cpt_Group_max;
    
    <span class="hljs-keyword">float</span> entropy;
    
    <span class="hljs-comment">//List of all the active candidates</span>
    <span class="hljs-keyword">list</span>&lt;candidate&gt; active_candidates ;
    
    init {
        <span class="hljs-comment">//Creation of the elector</span>
        create elector number: nb_electors;
        <span class="hljs-keyword">do</span> creation_candidates;
    }
    <span class="hljs-comment">//Action to create the candidates according to the distribution of candidates</span>
    action creation_candidates {
        <span class="hljs-keyword">switch</span> distribution_candidates { 
            match <span class="hljs-string">"Polygon"</span> {
                <span class="hljs-keyword">list</span>&lt;point&gt; liste_points &lt;- <span class="hljs-keyword">list</span>(nb_candidates points_at <span class="hljs-number">50.0</span>);
                <span class="hljs-keyword">int</span> cpt &lt;- <span class="hljs-number">0</span>;
                create candidate number: nb_candidates{
                     color &lt;- rgb (rnd(<span class="hljs-number">255</span>), rnd(<span class="hljs-number">255</span>), rnd(<span class="hljs-number">255</span>)); 
                     location &lt;- liste_points at cpt;
                     cpt &lt;- cpt + <span class="hljs-number">1</span>; 
                }
            }
            match <span class="hljs-string">"Line"</span> {
                <span class="hljs-keyword">int</span> cpt  &lt;- <span class="hljs-number">0</span>;
                create candidate number: nb_candidates{
                    color &lt;- rgb ([rnd(<span class="hljs-number">255</span>), rnd(<span class="hljs-number">255</span>), rnd(<span class="hljs-number">255</span>)]); 
                    <span class="hljs-keyword">float</span> x_cord  &lt;- <span class="hljs-number">200</span> * cpt / nb_candidates;
                    <span class="hljs-keyword">float</span> y_cord &lt;- <span class="hljs-number">100.0</span>;
                    location &lt;- {x_cord, y_cord};
                    cpt &lt;- cpt + <span class="hljs-number">1</span>;
                }
            }
            match <span class="hljs-string">"Diagonal"</span> {
                <span class="hljs-keyword">int</span> cpt &lt;- <span class="hljs-number">0</span>;
                create candidate number: nb_candidates{
                    color &lt;- rgb ([rnd(<span class="hljs-number">255</span>), rnd(<span class="hljs-number">255</span>), rnd(<span class="hljs-number">255</span>)]); 
                    <span class="hljs-keyword">float</span> x_cord &lt;- <span class="hljs-number">200</span> * cpt / nb_candidates;
                    <span class="hljs-keyword">float</span> y_cord &lt;- x_cord;
                    location &lt;- {x_cord, y_cord};
                    cpt &lt;- cpt + <span class="hljs-number">1</span>;
                }
            }
        }
        <span class="hljs-comment">//Initialization of all the active candidates as the list of candidates</span>
        active_candidates &lt;- <span class="hljs-keyword">list</span>(copy(candidate)); 
    }
    <span class="hljs-comment">//Reflex representing the dynamics of the models</span>
    reflex dynamique {
        <span class="hljs-comment">//For each elector, ask to move</span>
        ask elector {
            <span class="hljs-keyword">do</span> moving;
        }
        <span class="hljs-comment">//For each candidate, ask to move</span>
        ask active_candidates{
            <span class="hljs-keyword">do</span> moving;
            my_electors &lt;- <span class="hljs-keyword">list</span>&lt;elector&gt;([]);
        }
        <span class="hljs-comment">//For each elector, do its definition</span>
        ask elector {
            <span class="hljs-keyword">do</span> definition_candidate;
        }
        <span class="hljs-keyword">int</span> nb_electors_max &lt;- <span class="hljs-number">0</span>;
        candidate candidat_elected &lt;- nil; 
        
        <span class="hljs-comment">//Ask to all the active candidates to compute their percentage of vote and set the number of maximum electors to know which candidate is elected</span>
        ask active_candidates{ 
            <span class="hljs-keyword">int</span> nb_el &lt;- length(my_electors) ;
            percentage_vote &lt;- (nb_el/nb_electors * <span class="hljs-number">100</span>) with_precision <span class="hljs-number">2</span>;
            <span class="hljs-keyword">if</span> (nb_el &gt; nb_electors_max) {
                nb_electors_max &lt;- nb_el;
                candidat_elected &lt;- <span class="hljs-keyword">self</span>;
            }
        }
        <span class="hljs-comment">//update of the state of the candidate</span>
        ask candidate {
            is_elected &lt;- <span class="hljs-keyword">false</span>; 
        }
        ask candidat_elected {
            is_elected &lt;- <span class="hljs-keyword">true</span>; 
        }
    }
    <span class="hljs-comment">//Reflex to show the final results</span>
    reflex resultats_finaux when: time = <span class="hljs-number">72</span> {
        candidate elected &lt;- active_candidates with_max_of (each.percentage_vote);
        <span class="hljs-comment">//Display a window telling who is the winner and halt the model</span>
        <span class="hljs-keyword">do</span> tell message: <span class="hljs-string">"The winner is "</span> + elected.name; 
        <span class="hljs-keyword">do</span> halt;
    }
    
    <span class="hljs-comment">//Reflex to compute the creation of group when one candidate chooses this strategy</span>
    reflex creation_Group when: (strategy_candidates in [<span class="hljs-string">"Group"</span>, <span class="hljs-string">"Random"</span>]) {
         <span class="hljs-keyword">if</span> (cpt_Group = cpt_Group_max) {
            <span class="hljs-comment">//Kill all the group of electors</span>
            ask Group_electors <span class="hljs-keyword">as</span> <span class="hljs-keyword">list</span> {
                <span class="hljs-keyword">do</span> <span class="hljs-keyword">die</span>;
            }
            <span class="hljs-comment">//Compute the list of elector according to their distance</span>
            <span class="hljs-keyword">list</span>&lt;<span class="hljs-keyword">list</span>&lt;elector&gt;&gt; Groups;
            geometry geoms &lt;- union(elector collect ((each.shape) buffer ([<span class="hljs-string">"distance"</span>::float(threshold_attraction_electors) , <span class="hljs-string">"quadrantSegments"</span>::<span class="hljs-number">4</span>, <span class="hljs-string">"endCapStyle"</span>::<span class="hljs-number">1</span>])));
            loop geom over: geoms.geometries { 
                <span class="hljs-keyword">if</span> (geom != nil <span class="hljs-keyword">and</span> !<span class="hljs-keyword">empty</span>(geom.points)) {
                    <span class="hljs-keyword">list</span>&lt;elector&gt; els  &lt;- (elector inside geom); 
                    add els to: Groups;
                }
            }
            <span class="hljs-comment">//Create new groups of electors according to the list of electors</span>
            loop gp over: Groups {
                create Group_electors {
                     effectif &lt;- length(gp);
                     electors_dans_Group &lt;- gp;
                     location &lt;- mean(electors_dans_Group collect (each.location)) ;
                }
             }   
        }
        cpt_Group &lt;- cpt_Group - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (cpt_Group = <span class="hljs-number">0</span>) { cpt_Group &lt;- cpt_Group_max;}   
    }
    <span class="hljs-comment">//Reflex to compute the entropy</span>
    reflex calcule_entropy {
        entropy &lt;- <span class="hljs-number">0.0</span>;
        <span class="hljs-comment">//Compute the abstinence rate</span>
        <span class="hljs-keyword">float</span> abst &lt;- (nb_electors - sum (active_candidates  collect (length(each.my_electors)))) / nb_electors;
        <span class="hljs-keyword">if</span> (abst &gt; <span class="hljs-number">0</span>) {
            entropy &lt;- entropy - (abst * ln(abst));
        }
        <span class="hljs-comment">//Ask to all the active candidates their number of electors to compute the entropy</span>
        ask active_candidates {
            <span class="hljs-keyword">float</span> p &lt;- length(my_electors) / nb_electors;
            <span class="hljs-keyword">if</span> (p &gt; <span class="hljs-number">0</span>) {
                entropy &lt;- entropy - (p * ln(p));
            }
        }
        entropy &lt;- entropy / ln (length(active_candidates) + <span class="hljs-number">1</span>);
    }
}



<span class="hljs-comment">//Species representing a group of electors</span>
species Group_electors {
    <span class="hljs-keyword">int</span> effectif &lt;- <span class="hljs-number">0</span>;
    <span class="hljs-comment">//List of all the elector agents in the group</span>
    <span class="hljs-keyword">list</span>&lt;elector&gt; electors_dans_Group ;
    aspect <span class="hljs-keyword">default</span> {
        draw square(<span class="hljs-number">2</span>) color: <span class="hljs-comment">#orange;</span>
    } 
    
}
<span class="hljs-comment">//Species representing the elector moving </span>
species elector skills: [moving]{
    
    init {
        <span class="hljs-comment">//At initialization, place the elector in a certain place according to the distribution of electors</span>
        <span class="hljs-keyword">if</span> (distribution_electors = <span class="hljs-string">"Normal"</span>) {
            <span class="hljs-keyword">float</span> x_cord &lt;- max([<span class="hljs-number">0.0</span>, min([<span class="hljs-number">200.0</span>, gauss ({<span class="hljs-number">100</span>, <span class="hljs-number">35</span>})])]);
            <span class="hljs-keyword">float</span> y_cord &lt;- max([<span class="hljs-number">0.0</span>, min([<span class="hljs-number">200.0</span>, gauss ({<span class="hljs-number">100</span>, <span class="hljs-number">35</span>})])]);
            location &lt;- {x_cord, y_cord};
        }
    }
    rgb color &lt;- <span class="hljs-comment">#white;</span>
    <span class="hljs-comment">//Candidate chosen by the elector</span>
    candidate my_candidate;  
    
    aspect base {
        draw triangle(<span class="hljs-number">2</span>) color: color ;
    } 
    <span class="hljs-comment">//Action to define the candidate</span>
    action definition_candidate {
        <span class="hljs-comment">//The candidate chosen is the one closest to the elector in the attraction range</span>
        my_candidate &lt;- active_candidates with_min_of (<span class="hljs-keyword">self</span> distance_to each);
        my_candidate &lt;- (<span class="hljs-keyword">self</span> distance_to my_candidate &lt; threshold_attraction_candidates) ? my_candidate : nil;
        <span class="hljs-keyword">if</span> (my_candidate != nil) {
            add <span class="hljs-keyword">self</span> to: my_candidate.my_electors; 
            color &lt;- my_candidate.color;
        }
    }
    <span class="hljs-comment">//Action to move the elector</span>
    action moving {
        <span class="hljs-comment">//Make the agent move closer to another elector, representing the influence of this one</span>
        <span class="hljs-keyword">if</span> ( rnd(<span class="hljs-number">100</span>) &gt; (weight_candidates)) {
            elector my_elector &lt;- shuffle(elector) first_with ((<span class="hljs-keyword">self</span> distance_to each) &lt; threshold_attraction_electors);
            <span class="hljs-keyword">if</span> (my_elector != nil) {
                <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> target:my_elector speed: distance_traveled;
            } 
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//Move the elector closer to one of the candidate to represent its repulsion or attraction</span>
            candidate the_candidate &lt;- one_of(candidate) ;
            <span class="hljs-keyword">if</span> (the_candidate != nil) {
                <span class="hljs-keyword">float</span> dist &lt;- <span class="hljs-keyword">self</span> distance_to the_candidate;
                <span class="hljs-keyword">if</span> dist &lt; threshold_attraction_candidates {
                    <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> target: the_candidate speed: distance_traveled;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> dist &gt; threshold_repulsion_candidates {
                    <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> target: location + location - the_candidate.location speed: distance_traveled;
                }
            }
        }
        
    } 
    
}
<span class="hljs-comment">//Species candidate using the skill moving</span>
species candidate skills:[moving]{
    rgb color &lt;- rgb([<span class="hljs-number">100</span> + rnd(<span class="hljs-number">155</span>),<span class="hljs-number">100</span> + rnd(<span class="hljs-number">155</span>),<span class="hljs-number">100</span> + rnd(<span class="hljs-number">155</span>)]);
    <span class="hljs-comment">//Boolean to know if the candidate is active</span>
    <span class="hljs-keyword">bool</span> active &lt;- <span class="hljs-keyword">true</span>;
    <span class="hljs-comment">//Float representing the percentage of vote for the candidate</span>
    <span class="hljs-keyword">float</span> percentage_vote; 
    <span class="hljs-comment">//List of all the electors of the candidate</span>
    <span class="hljs-keyword">list</span> my_electors of: elector;
    <span class="hljs-comment">//Boolean to know if the candidate is elected</span>
    <span class="hljs-keyword">bool</span> is_elected &lt;- <span class="hljs-keyword">false</span>;
    aspect <span class="hljs-keyword">default</span> {
        draw circle(<span class="hljs-number">3</span>) color: color;
    } 
    aspect dynamic {
        <span class="hljs-keyword">if</span> (active) {
            <span class="hljs-keyword">float</span> radius  &lt;- <span class="hljs-number">1</span> + (percentage_vote / <span class="hljs-number">4.0</span>);
            <span class="hljs-keyword">if</span> (is_elected) {
                draw square( radius *<span class="hljs-number">1.5</span>) color: <span class="hljs-comment">#red; </span>
                draw circle(radius) color: color;
            } <span class="hljs-keyword">else</span> {
                draw circle(radius) color: color;
            }
            draw string(percentage_vote) size: <span class="hljs-number">5</span> color: <span class="hljs-comment">#white;</span>
        }
    }
    <span class="hljs-comment">//Action to move the candidate according to its strategy</span>
    action moving {
        <span class="hljs-keyword">switch</span> strategy_candidates {
            match <span class="hljs-string">"No strategy"</span> {}
            match <span class="hljs-string">"Search electors"</span> {<span class="hljs-keyword">do</span> strategy_1;}
            match <span class="hljs-string">"Distinction"</span> {<span class="hljs-keyword">do</span> strategy_2;}
            match <span class="hljs-string">"Group"</span> {<span class="hljs-keyword">do</span> strategy_3;}
            match <span class="hljs-string">"Go closer to the best"</span> {<span class="hljs-keyword">do</span> strategy_4;}
            match <span class="hljs-string">"Random"</span> { 
                <span class="hljs-keyword">switch</span> (rnd(<span class="hljs-number">4</span>)) {
                    match <span class="hljs-number">0</span> {}
                    match <span class="hljs-number">1</span> {<span class="hljs-keyword">do</span> strategy_1;}    
                    match <span class="hljs-number">2</span> {<span class="hljs-keyword">do</span> strategy_2;}    
                    match <span class="hljs-number">3</span> {<span class="hljs-keyword">do</span> strategy_3;}    
                    match <span class="hljs-number">4</span> {<span class="hljs-keyword">do</span> strategy_4;}        
                }
            }
        }
    }
    
    action strategy_1 {
        <span class="hljs-comment">//go closer to electors</span>
        elector my_elector &lt;- shuffle(elector) first_with ((<span class="hljs-keyword">self</span> distance_to each) &lt; threshold_attraction_electors);
        <span class="hljs-keyword">if</span> (my_elector != nil) {
            <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> target:my_elector speed: distance_traveled;
        } 
    }
    
    action strategy_2 {
        <span class="hljs-comment">//go in opposite directions to other candidates</span>
        <span class="hljs-keyword">list</span>&lt;candidate&gt; cands &lt;- <span class="hljs-keyword">list</span>(copy(candidate));
        remove <span class="hljs-keyword">self</span> from: cands;
        candidate the_candidate &lt;- one_of(cands) ;
        <span class="hljs-keyword">if</span> (the_candidate != nil) {
            <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> target: (location + location - the_candidate.location) speed: distance_traveled;    
        }
    }
    
    action strategy_3 {
        <span class="hljs-comment">//go closer to a group of electors</span>
        Group_electors mon_Group  &lt;- (Group_electors where ((<span class="hljs-keyword">self</span> distance_to each) &lt; threshold_attraction_electors)) with_max_of (each.effectif);
        <span class="hljs-keyword">if</span> (mon_Group != nil) {
            <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> target:mon_Group speed: distance_traveled;
        } 
    }
    
    action strategy_4 {
        <span class="hljs-comment">//go toward the candidate with max of votes</span>
        candidate the_candidate &lt;- candidate with_max_of (percentage_vote) ;
        <span class="hljs-keyword">if</span> (the_candidate != nil) {
            <span class="hljs-keyword">do</span> <span class="hljs-keyword">goto</span> target:the_candidate speed: distance_traveled;  
        }
    }
    
}


experiment vote type: gui {
    <span class="hljs-comment">/** Insert here the definition of the input and output of the model */</span>
    parameter <span class="hljs-string">"Number of electors : "</span> <span class="hljs-keyword">var</span>: nb_electors category: <span class="hljs-string">"elector"</span>;
    parameter <span class="hljs-string">"Moving speed of electors toward another electors : "</span> <span class="hljs-keyword">var</span>: distance_traveled category: <span class="hljs-string">"elector"</span>;
    parameter <span class="hljs-string">"Attraction distance between electors : "</span> <span class="hljs-keyword">var</span>: threshold_attraction_electors category: <span class="hljs-string">"elector"</span>;
    parameter <span class="hljs-string">"Number of candidates : "</span> <span class="hljs-keyword">var</span>: nb_candidates category: <span class="hljs-string">"Candidate"</span>;
    parameter <span class="hljs-string">"Attraction distance between candidates and electors : "</span> <span class="hljs-keyword">var</span>: threshold_attraction_candidates category: <span class="hljs-string">"elector"</span>;
    
    parameter <span class="hljs-string">"Repulsion distance between candidates : "</span> <span class="hljs-keyword">var</span>: threshold_repulsion_candidates category: <span class="hljs-string">"elector"</span>;
    parameter <span class="hljs-string">"weight of candidates : "</span> <span class="hljs-keyword">var</span>: weight_candidates category: <span class="hljs-string">"Candidate"</span>;
    
    parameter <span class="hljs-string">"Distribution type of electors : "</span> <span class="hljs-keyword">var</span>: distribution_electors category: <span class="hljs-string">"elector"</span>;
    parameter <span class="hljs-string">"Distribution type of  candidates : "</span> <span class="hljs-keyword">var</span>: distribution_candidates category: <span class="hljs-string">"Candidate"</span>;
    parameter <span class="hljs-string">"Strategy of candidates : "</span> <span class="hljs-keyword">var</span>: strategy_candidates category: <span class="hljs-string">"Candidate"</span>;
    
    output {
        display main background: <span class="hljs-comment">#black { </span>
            species elector aspect: base;
            species candidate aspect: dynamic;
            species Group_electors;
            
        }
        display votants {
            chart <span class="hljs-string">"Distribution of electors"</span> type: pie background: <span class="hljs-comment">#white  {</span>
                loop cand over: candidate {
                    data  cand.name value:cand.percentage_vote color: cand.color ;
                }   
            }
            
            }
        display indicateurs {
            chart <span class="hljs-string">"Shannon Entropy"</span> type: series background: <span class="hljs-comment">#white size: {1,0.5} position: {0, 0} {</span>
                data <span class="hljs-string">"entropy"</span> value: entropy color: <span class="hljs-comment">#blue ;</span>
            }
            chart <span class="hljs-string">"Opinion distribution"</span> type: series background: <span class="hljs-comment">#white size: {1,0.5} position: {0, 0.5} {</span>
                data <span class="hljs-string">"Space area covered"</span> value: (union(candidate collect (each.shape buffer threshold_attraction_candidates))).area / <span class="hljs-number">40000</span> color: <span class="hljs-comment">#blue ;</span>
            }
        }
    }
}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>