<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Additionnal Plugins/Ordinary Differential Equations/Ordinary Differential Equations SIR (Split in Agents, Multiple Strains) --><head><meta charset="utf-8"><title>Ordinary Differential Equations SIR (Split in Agents, Multiple Strains)</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="ordinary-differential-equations-sir-split-in-agents-multiple-strains">Ordinary Differential Equations SIR (Split in Agents, Multiple Strains)</h1>
<h1 id="sir-split-in-agents-multiple-strains">SIR (Split in Agents, Multiple Strains)</h1>
<p><em>Author : tri and nghi</em></p>
<p>This model is an extension of the model SIR_split_in_agents.gaml. It creates several agents of one compartment type (here typically several I_agt).</p>
<p><img src="../../../../../github.com/wiki/gama-platform/gama/References/ModelLibrary/Additionnal Plugins/Ordinary Differential Equations/gm_wiki/resources/images/modelLibraryScreenshots/Additionnal Plugins/Ordinary Differential Equations/Ordinary Differential Equations SIR (Split in Agents, Multiple Strains)/chart_1system_eq-10.png" alt="Eclipse folder." title="" class="img-responsive"> == $0</p><p></p><p><img src="../../../../../github.com/wiki/gama-platform/gama/References/ModelLibrary/Additionnal Plugins/Ordinary Differential Equations/gm_wiki/resources/images/modelLibraryScreenshots/Additionnal Plugins/Ordinary Differential Equations/Ordinary Differential Equations SIR (Split in Agents, Multiple Strains)/chart_3system_eq-10.png" alt="Eclipse folder." title="" class="img-responsive"> == $0</p>Code of the model : <p></p>
<pre><code class="hljs zephir">model SIR_split_in_agents_multiple_strains

<span class="hljs-keyword">global</span> {
    <span class="hljs-comment">// Parameters</span>
    <span class="hljs-keyword">int</span> number_S &lt;- <span class="hljs-number">495</span> ; <span class="hljs-comment">// The number of susceptible</span>
    <span class="hljs-keyword">int</span> number_I &lt;- <span class="hljs-number">5</span> ; <span class="hljs-comment">// The number of infected</span>
    <span class="hljs-keyword">int</span> number_R &lt;- <span class="hljs-number">0</span> ; <span class="hljs-comment">// The number of removed </span>

    <span class="hljs-keyword">float</span> _beta &lt;- <span class="hljs-number">1.0</span> ; <span class="hljs-comment">// The parameter Beta</span>
    <span class="hljs-keyword">float</span> _delta &lt;- <span class="hljs-number">0.01</span> ; <span class="hljs-comment">// The parameter Delta</span>
    
    <span class="hljs-comment">// Global variables</span>
    <span class="hljs-keyword">int</span> strain_number &lt;- <span class="hljs-number">2</span>;
    <span class="hljs-keyword">int</span> N &lt;- number_S + number_I * strain_number + number_R;    
    <span class="hljs-keyword">float</span> hKR4 &lt;- <span class="hljs-number">0.01</span>;
    
    init {
        create S_agt {
            Ssize &lt;- <span class="hljs-keyword">float</span>(number_S);
        }

        create I_agt number: strain_number {
            Isize &lt;- <span class="hljs-keyword">float</span>(number_I);
            <span class="hljs-keyword">self</span>.beta &lt;- _beta; 
            <span class="hljs-keyword">self</span>.delta &lt;- _delta; 
        }

        create R_agt {
            Rsize &lt;- <span class="hljs-keyword">float</span>(number_R);
        }

        create my_SIR_maths {
            <span class="hljs-keyword">self</span>.Sm &lt;- <span class="hljs-keyword">float</span>(number_S);
            <span class="hljs-keyword">self</span>.Im &lt;- <span class="hljs-keyword">float</span>(number_I) * strain_number;
            <span class="hljs-keyword">self</span>.Rm &lt;- <span class="hljs-keyword">float</span>(number_R);
        }

        write <span class="hljs-string">'Basic Reproduction Number (R0): '</span> + string(_beta * number_S / (_delta));
    }

}


species S_agt {
    <span class="hljs-keyword">float</span> t;        
    <span class="hljs-keyword">float</span> Ssize;
    
    equation evol simultaneously: [I_agt, R_agt] {
        diff(<span class="hljs-keyword">self</span>.Ssize, t) = (- sum(I_agt accumulate [each.beta * each.Isize]) * <span class="hljs-keyword">self</span>.Ssize / N);
    }

    reflex solving {solve evol method: <span class="hljs-string">"rk4"</span> step: hKR4 ;}
}

species I_agt {
    <span class="hljs-keyword">float</span> t;        
    <span class="hljs-keyword">float</span> Isize;
     
    <span class="hljs-keyword">float</span> beta;
    <span class="hljs-keyword">float</span> delta;
    
    equation evol simultaneously: [S_agt, R_agt] {
        diff(<span class="hljs-keyword">self</span>.Isize, t) = (beta * first(S_agt).Ssize * <span class="hljs-keyword">self</span>.Isize / N) - (delta * <span class="hljs-keyword">self</span>.Isize);
    }
}

species R_agt {
    <span class="hljs-keyword">float</span> t;        
    <span class="hljs-keyword">float</span> Rsize;

    equation evol simultaneously: [I_agt] {
        diff(<span class="hljs-keyword">self</span>.Rsize, t) = (sum(I_agt collect (each.delta * each.Isize)));
    }
}

species my_SIR_maths {
    <span class="hljs-keyword">float</span> t;
    <span class="hljs-keyword">float</span> Im;
    <span class="hljs-keyword">float</span> Sm;
    <span class="hljs-keyword">float</span> Rm;
    
    equation SIR {
        diff(<span class="hljs-keyword">self</span>.Sm, t) = (-_beta * Sm * Im / N);
        diff(<span class="hljs-keyword">self</span>.Im, t) = (_beta * Sm * Im / N) - (_delta * Im);
        diff(<span class="hljs-keyword">self</span>.Rm, t) = (_delta * Im);
    }

    reflex solving {solve SIR method: <span class="hljs-string">"rk4"</span> step: hKR4;}
}



experiment Simulation type: gui {
    parameter <span class="hljs-string">'Number of Susceptible'</span> type: <span class="hljs-keyword">int</span> <span class="hljs-keyword">var</span>: number_S &lt;- <span class="hljs-number">495</span> category: <span class="hljs-string">"Initial population"</span>; 
    parameter <span class="hljs-string">'Number of Infected'</span>    type: <span class="hljs-keyword">int</span> <span class="hljs-keyword">var</span>: number_I &lt;- <span class="hljs-number">5</span>   category: <span class="hljs-string">"Initial population"</span>;
    parameter <span class="hljs-string">'Number of Removed'</span>     type: <span class="hljs-keyword">int</span> <span class="hljs-keyword">var</span>: number_R &lt;- <span class="hljs-number">0</span>   category: <span class="hljs-string">"Initial population"</span>;

    parameter <span class="hljs-string">'Beta (S-&gt;I)'</span>  type: <span class="hljs-keyword">float</span> <span class="hljs-keyword">var</span>: _beta &lt;- <span class="hljs-number">1.0</span>   category: <span class="hljs-string">"Parameters"</span>;
    parameter <span class="hljs-string">'Delta (I-&gt;R)'</span> type: <span class="hljs-keyword">float</span> <span class="hljs-keyword">var</span>: _delta &lt;- <span class="hljs-number">0.01</span> category: <span class="hljs-string">"Parameters"</span>;    
    
    output {
        display chart_3system_eq {
            chart <span class="hljs-string">'Split system'</span> type: series background: <span class="hljs-comment">#lightgray {</span>
                data <span class="hljs-string">'susceptible'</span> value: first(S_agt).Ssize color: <span class="hljs-comment">#green;</span>
                data <span class="hljs-string">'infected0'</span> value: first(I_agt).beta * first(I_agt).Isize color: <span class="hljs-comment">#white;</span>
                data <span class="hljs-string">'infected1'</span> value: last(I_agt).beta * last(I_agt).Isize color: <span class="hljs-comment">#yellow;</span>
                data <span class="hljs-string">'i1+i2'</span> value: sum(I_agt accumulate (each.beta * each. Isize)) color: rgb ( <span class="hljs-string">'red'</span> ) ;              
                data <span class="hljs-string">'recovered'</span> value: first(R_agt).Rsize color: <span class="hljs-comment">#blue;</span>
            }

        }

        display chart_1system_eq  {
            chart <span class="hljs-string">'unified system'</span> type: series background: <span class="hljs-comment">#lightgray {</span>
                data <span class="hljs-string">'susceptible_maths'</span> value: first(my_SIR_maths).Sm color: <span class="hljs-comment">#green;</span>
                data <span class="hljs-string">'infected_maths'</span> value: first(my_SIR_maths).Im color: <span class="hljs-comment">#red;</span>
                data <span class="hljs-string">'recovered_maths'</span> value: first(my_SIR_maths).Rm color: <span class="hljs-comment">#blue;</span>
            }
        }
    }
}

</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>