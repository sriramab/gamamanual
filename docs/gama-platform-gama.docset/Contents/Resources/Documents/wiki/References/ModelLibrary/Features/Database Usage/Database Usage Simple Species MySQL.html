<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Features/Database Usage/Database Usage Simple Species MySQL --><head><meta charset="utf-8"><title>Database Usage Simple Species MySQL</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="database-usage-simple-species-mysql">Database Usage Simple Species MySQL</h1>
<h1 id="simple-species-mysql">Simple Species MySql</h1>
<p><em>Author : Truong Minh Thai</em></p>
<p>This model illustrates the use of the AgentDB species (instead of the SQLSKILL), and in particular following actions:</p>
<ul>
<li></li>
<li><p>testConection</p>
</li>
<li></li>
<li><p>isConnected</p>
</li>
<li></li>
<li><p>close </p>
</li>
<li></li>
<li><p>executeUpdate</p>
</li>
<li></li>
<li><p>insert</p>
</li>
<li></li>
<li><p>select</p>
</li>
<li></li>
<li><p>getParameter </p>
</li>
<li><p>This model does SQl query commands:</p>
</li>
<li></li>
<li><p>Create table </p>
</li>
<li></li>
<li><p>Insert data</p>
</li>
<li></li>
<li><p>Select data</p>
</li>
<li></li>
<li><p>Delete data</p>
</li>
<li></li>
<li><p>Drop table </p>
</li>
<li><p>NOTE: YOU SHOULD HAVE ALREADY CREATED YOUR DATABASE (meteo_DB here) AND IMPORTED THE FILE (../../includes/meteo_DB_dump.sql)</p>
</li>
<li>IN ORDER THAT THE MODEL CAN RUN PROPERLY.</li>
</ul>
<p>Code of the model : </p>
<pre><code class="hljs perl">model simpleSQL_DBSpecies_MySQL

global {
    <span class="hljs-keyword">map</span>&lt;string, string&gt; PARAMS &lt;- [<span class="hljs-string">'host'</span>::<span class="hljs-string">'localhost'</span>, <span class="hljs-string">'dbtype'</span>::<span class="hljs-string">'MySQL'</span>, <span class="hljs-string">'database'</span>::<span class="hljs-string">'meteo_DB'</span>, <span class="hljs-string">'port'</span>::<span class="hljs-string">'8889'</span>, <span class="hljs-string">'user'</span>::<span class="hljs-string">'root'</span>, <span class="hljs-string">'passwd'</span>::<span class="hljs-string">'root'</span>];
    init {
        create DB_Accessor number: <span class="hljs-number">1</span> {
            <span class="hljs-keyword">if</span> (self testConnection (params::PARAMS) = false) {
                <span class="hljs-keyword">write</span> <span class="hljs-string">"Impossible connection"</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">write</span> <span class="hljs-string">"Connection of "</span> + self;
                <span class="hljs-keyword">do</span> <span class="hljs-keyword">connect</span> params: PARAMS;
            }

        }

        <span class="hljs-keyword">if</span> (first(DB_Accessor) isConnected [] = false) {
            <span class="hljs-keyword">write</span> <span class="hljs-string">"No connection."</span>;
            ask (AgentDB) {
                <span class="hljs-keyword">do</span> <span class="hljs-keyword">close</span>;
            }

            <span class="hljs-keyword">do</span> halt;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">write</span> <span class="hljs-string">""</span> + first(DB_Accessor) getParameter ();
        }

        ask (DB_Accessor) {
            <span class="hljs-keyword">do</span> executeUpdate updateComm: <span class="hljs-string">"CREATE TABLE registration"</span> + <span class="hljs-string">"(id INTEGER PRIMARY KEY, "</span> + <span class="hljs-string">" first TEXT NOT NULL, "</span> + <span class="hljs-string">" last TEXT NOT NULL, "</span> + <span class="hljs-string">" age INTEGER);"</span>;
            <span class="hljs-keyword">write</span> <span class="hljs-string">"REGISTRATION table has been created."</span>;
            <span class="hljs-keyword">do</span> executeUpdate updateComm: <span class="hljs-string">"INSERT INTO registration "</span> + <span class="hljs-string">"VALUES(100, 'Zara', 'Ali', 18);"</span>;
            <span class="hljs-keyword">do</span> executeUpdate updateComm: <span class="hljs-string">"INSERT INTO registration "</span> + <span class="hljs-string">"VALUES(?, ?, ?, ?);"</span> <span class="hljs-keyword">values</span>: [<span class="hljs-number">101</span>, <span class="hljs-string">'Mr'</span>, <span class="hljs-string">'Mme'</span>, <span class="hljs-number">45</span>];
            <span class="hljs-keyword">do</span> insert into: <span class="hljs-string">"registration"</span> <span class="hljs-keyword">values</span>: [<span class="hljs-number">102</span>, <span class="hljs-string">'Mahnaz'</span>, <span class="hljs-string">'Fatma'</span>, <span class="hljs-number">25</span>];
            <span class="hljs-keyword">do</span> insert into: <span class="hljs-string">"registration"</span> columns: [<span class="hljs-string">"id"</span>, <span class="hljs-string">"first"</span>, <span class="hljs-string">"last"</span>] <span class="hljs-keyword">values</span>: [<span class="hljs-number">103</span>, <span class="hljs-string">'Zaid tim'</span>, <span class="hljs-string">'Kha'</span>];
            <span class="hljs-keyword">do</span> insert into: <span class="hljs-string">"registration"</span> columns: [<span class="hljs-string">"id"</span>, <span class="hljs-string">"first"</span>, <span class="hljs-string">"last"</span>] <span class="hljs-keyword">values</span>: [<span class="hljs-number">104</span>, <span class="hljs-string">'Bill'</span>, <span class="hljs-string">'Clark'</span>];
            <span class="hljs-keyword">write</span> <span class="hljs-string">"Five records have been inserted."</span>;
            <span class="hljs-keyword">write</span> <span class="hljs-string">"Click on &lt;&lt;Step&gt;&gt; button to view selected data"</span>;
        }

    }

}

species DB_Accessor parent: AgentDB {
    reflex <span class="hljs-keyword">select</span> {
        list&lt;list&gt; t &lt;- list&lt;list&gt; (self <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span>::<span class="hljs-string">"SELECT * FROM registration"</span>));
        <span class="hljs-keyword">write</span> <span class="hljs-string">"Select before updated "</span> + t;
    }

    reflex update {
        <span class="hljs-keyword">do</span> executeUpdate updateComm: <span class="hljs-string">"UPDATE registration SET age = 30 WHERE id IN (100, 101)"</span>;
        <span class="hljs-keyword">do</span> executeUpdate updateComm: <span class="hljs-string">"DELETE FROM registration where id=103 "</span>;
        list&lt;list&gt; t &lt;- list&lt;list&gt; (self <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span>::<span class="hljs-string">"SELECT * FROM registration"</span>));
        <span class="hljs-keyword">write</span> <span class="hljs-string">"Select after updated "</span> + t;
    }

    reflex drop {
        <span class="hljs-keyword">do</span> executeUpdate updateComm: <span class="hljs-string">"DROP TABLE registration"</span>;
        <span class="hljs-keyword">write</span> <span class="hljs-string">"Registration table has been dropped."</span>;
    }

}

experiment simple_SQL_exp type: gui {
}     
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>