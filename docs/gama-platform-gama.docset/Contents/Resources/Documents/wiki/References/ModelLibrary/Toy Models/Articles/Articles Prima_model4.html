<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Toy Models/Articles/Articles Prima_model4 --><head><meta charset="utf-8"><title>Articles Prima_model4</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="articles-prima_model4">Articles Prima_model4</h1>
<h1 id="prima-4">Prima 4</h1>
<p>_Author : _</p>
<p>This model shows how to create agent and make them move randomly in the world.Some agents are infected, and others can gain the infection if they are in a certain range. The people are now placed in buildings at the initial state. Those buildings are created thanks toa shapefile. Roads are also created thanks to an other shapefile. A graph is now created fromthe road agents, and the people move from their location to a targent on the graph. The displayis now a 3D display.</p>
<p>Code of the model : </p>
<pre><code class="hljs processing">model model4 

global {
    <span class="hljs-comment">//Shapefile for the roads</span>
    file roads_shapefile &lt;- shape_file(<span class="hljs-string">"../includes/road.shp"</span>);
    <span class="hljs-comment">//Shapefile for the buildings</span>
    file buildings_shapefile &lt;- file(<span class="hljs-string">"../includes/building.shp"</span>);
    <span class="hljs-comment">//The world bounds are now the shapefile roads 's boundss</span>
    geometry <span class="hljs-built_in">shape</span> &lt;- envelope(roads_shapefile);
    <span class="hljs-comment">//The graph of roads on which people will move</span>
    graph road_network;
    init {
        <span class="hljs-comment">//Creation of the roads using the road shapefile</span>
        create roads from: roads_shapefile;
        <span class="hljs-comment">//Creation of the graph using roads as the edges of the graph</span>
        road_network &lt;- as_edge_graph(roads);
        <span class="hljs-comment">//Creation of the buildings from the building shapefile</span>
        create buildings from: buildings_shapefile;
        <span class="hljs-comment">//Creation of the people agent, located in one of the building</span>
        create people number:<span class="hljs-number">1000</span> {
            buildings init_place &lt;- one_of(buildings);
            location &lt;- any_location_in(init_place) + {<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, init_place.<span class="hljs-built_in">height</span>};
            target &lt;- any_location_in(one_of(buildings));
        }
    }
}
<span class="hljs-comment">//Species people that will move from a location to a target and can be infected</span>
species people skills:[moving]{     
    <span class="hljs-built_in">float</span> speed &lt;- <span class="hljs-number">5.0</span> + rnd(<span class="hljs-number">5</span>);
    bool is_infected &lt;- flip(<span class="hljs-number">0.01</span>);
    <span class="hljs-built_in">point</span> target;
    
    <span class="hljs-comment">//Reflex to move to the target on the graph of roads</span>
    reflex move {
        do goto target:target on: road_network;
        <span class="hljs-comment">//Once the target is reached, find an other target</span>
        <span class="hljs-keyword">if</span> (location = target) {
            target &lt;- any_location_in(one_of(buildings));
        }
    }
    <span class="hljs-comment">//Reflex to check if we are infected if we aren't already and infected people are nearby</span>
    reflex infect when: is_infected{
        ask people at_distance <span class="hljs-number">10</span> {
            <span class="hljs-keyword">if</span> flip(<span class="hljs-number">0.01</span>) {
                is_infected &lt;- <span class="hljs-keyword">true</span>;
            }
        }
    }
    aspect circle{
        <span class="hljs-title">draw</span> <span class="hljs-built_in">sphere</span>(<span class="hljs-number">5</span>) <span class="hljs-built_in">color</span>:is_infected ? #<span class="hljs-built_in">red</span> : #<span class="hljs-built_in">green</span>;
    }
}

species roads {
    aspect geom {
        <span class="hljs-title">draw</span> <span class="hljs-built_in">shape</span> <span class="hljs-built_in">color</span>: #black;
    }
}

species buildings {
    <span class="hljs-built_in">float</span> <span class="hljs-built_in">height</span> &lt;- <span class="hljs-number">10.0</span>+ rnd(<span class="hljs-number">10</span>);
    aspect geom {
        <span class="hljs-title">draw</span> <span class="hljs-built_in">shape</span> <span class="hljs-built_in">color</span>: #gray depth: <span class="hljs-built_in">height</span>;
    }
}

experiment main_experiment type:gui{
    output {
        <span class="hljs-comment">//Type opengl to display in 3D</span>
        display <span class="hljs-built_in">map</span> type: opengl {
            species roads aspect:geom;
            species buildings aspect:geom;
            species people aspect:circle;           
        }
    }
}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>