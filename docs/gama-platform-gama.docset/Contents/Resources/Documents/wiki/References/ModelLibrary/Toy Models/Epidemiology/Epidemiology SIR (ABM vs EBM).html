<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Toy Models/Epidemiology/Epidemiology SIR (ABM vs EBM) --><head><meta charset="utf-8"><title>Epidemiology SIR (ABM vs EBM)</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="epidemiology-sir-abm-vs-ebm">Epidemiology SIR (ABM vs EBM)</h1>
<h1 id="comparison_abm_ebm_sir">comparison_ABM_EBM_SIR</h1>
<p>_Author : Benoit Gaudou _</p>
<p>Comparison between an agent-based and an equation-based model of the SIR model. The ABM use a grid to place the agents, and each cell will be the location of an agent, while the EBM is only using a ODE System and no geographical representation.</p>
<p>Code of the model : </p>
<pre><code class="hljs cs">model comparison_ABM_EBM_SIR

global {
    <span class="hljs-comment">//Number of susceptible individuals</span>
    <span class="hljs-keyword">int</span> number_S &lt;- <span class="hljs-number">499</span>; 
    <span class="hljs-comment">//Number of infectious individuals</span>
    <span class="hljs-keyword">int</span> number_I &lt;- <span class="hljs-number">1</span>; 
    <span class="hljs-comment">//Number of Resistant individuals</span>
    <span class="hljs-keyword">int</span> number_R &lt;- <span class="hljs-number">0</span>; 
    <span class="hljs-comment">//Beta parameter used for the infection of susceptible individuals</span>
    <span class="hljs-keyword">float</span> beta &lt;- <span class="hljs-number">0.1</span>; 
    <span class="hljs-comment">//Gamma parameter used for the resistance gained by the infectious individuals</span>
    <span class="hljs-keyword">float</span> gamma &lt;- <span class="hljs-number">0.01</span>;
    <span class="hljs-comment">//Size of the neighbours</span>
    <span class="hljs-keyword">int</span> neighbours_size &lt;- <span class="hljs-number">2</span>;
    <span class="hljs-comment">//Total number of individuals</span>
    <span class="hljs-keyword">int</span> N &lt;- number_S + number_I + number_R;
    <span class="hljs-comment">//Number of hosts (for ABM)</span>
    <span class="hljs-keyword">int</span> nb_hosts &lt;- number_S + number_I + number_R update: length(Host);
    <span class="hljs-comment">//Number of infected hosts (for ABM)</span>
    <span class="hljs-keyword">int</span> nb_infected &lt;- number_I update:  <span class="hljs-function">Host <span class="hljs-title">count</span> (<span class="hljs-params">each.is_infected</span>)</span>;
    <span class="hljs-keyword">float</span> hKR4 &lt;- <span class="hljs-number">0.7</span>;
    geometry shape &lt;- square(<span class="hljs-number">50</span>);
    init {
        <span class="hljs-comment">//Create the number of hosts susceptibles</span>
        create Host number: number_S {
            is_susceptible &lt;- <span class="hljs-literal">true</span>;
            is_infected &lt;- <span class="hljs-literal">false</span>;
            is_immune &lt;- <span class="hljs-literal">false</span>;
            color &lt;- <span class="hljs-meta">#green;</span>
        }
        <span class="hljs-comment">//Create the number of hosts infectious</span>
        create Host number: number_I {
            is_susceptible &lt;- <span class="hljs-literal">false</span>;
            is_infected &lt;- <span class="hljs-literal">true</span>;
            is_immune &lt;- <span class="hljs-literal">false</span>;
            color &lt;- <span class="hljs-meta">#red;</span>
        }
        <span class="hljs-comment">//Create the node agent for the SIR ODE System</span>
        create node_agent number: <span class="hljs-number">1</span> {
            S &lt;- <span class="hljs-keyword">float</span>(number_S);
            I &lt;- <span class="hljs-keyword">float</span>(number_I);
            R &lt;- <span class="hljs-keyword">float</span>(number_R);
        }
    }

}
<span class="hljs-comment">//Grid that will be used to discretize space</span>
grid sir_grid width: <span class="hljs-number">50</span> height: <span class="hljs-number">50</span> {
        rgb color &lt;- <span class="hljs-meta">#black;</span>
        list&lt;sir_grid&gt; neighbours &lt;- (self neighbors_at neighbours_size) of_species sir_grid;
    }
    
<span class="hljs-comment">//Species host which represents the host of the disease</span>
species Host {
    
    <span class="hljs-comment">//Different booleans to know in which state is the host</span>
    <span class="hljs-keyword">bool</span> is_susceptible &lt;- <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">bool</span> is_infected &lt;- <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">bool</span> is_immune &lt;- <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">//Color of the host</span>
    rgb color &lt;- <span class="hljs-meta">#green;</span>
    
    <span class="hljs-comment">//Location of the agent among the grid</span>
    sir_grid myPlace;
    <span class="hljs-comment">//Count of neighbors infected </span>
    <span class="hljs-keyword">int</span> ngb_infected_number function: {<span class="hljs-function">self <span class="hljs-title">neighbors_at</span>(<span class="hljs-params">neighbours_size</span>) <span class="hljs-title">count</span>(<span class="hljs-params">each.is_infected</span>)}</span>;
    
    init {
        <span class="hljs-comment">//The location is chosen randomly</span>
        myPlace &lt;- one_of(sir_grid);
        location &lt;- myPlace.location;
    }
    <span class="hljs-comment">//Reflex to move the agent in the neighbours cells</span>
    reflex basic_move {
        myPlace &lt;- one_of(myPlace.neighbours);
        location &lt;- myPlace.location;
    }
    <span class="hljs-comment">//Reflex to pass the agent to the state infected </span>
    reflex become_infected <span class="hljs-keyword">when</span>: is_susceptible {
            <span class="hljs-comment">//Probability of being infected according to the number of infected among the neighbours</span>
            <span class="hljs-keyword">if</span> (flip(<span class="hljs-number">1</span> - (<span class="hljs-number">1</span> - beta)  ^ ngb_infected_number)) {
                is_susceptible &lt;-  <span class="hljs-literal">false</span>;
                    is_infected &lt;-  <span class="hljs-literal">true</span>;
                    is_immune &lt;-  <span class="hljs-literal">false</span>;
                    color &lt;-  <span class="hljs-meta">#red;                 </span>
            }                   
    }
    <span class="hljs-comment">//Reflex to pass the agent to the state immune</span>
    reflex become_immune <span class="hljs-keyword">when</span>: (<span class="hljs-function">is_infected and <span class="hljs-title">flip</span>(<span class="hljs-params">gamma</span>)) </span>{
        is_susceptible &lt;- <span class="hljs-literal">false</span>;
        is_infected &lt;- <span class="hljs-literal">false</span>;
        is_immune &lt;- <span class="hljs-literal">true</span>;
        color &lt;- <span class="hljs-meta">#blue;</span>
    } 
    
    aspect basic {
        <span class="hljs-function">draw <span class="hljs-title">circle</span>(<span class="hljs-params"><span class="hljs-number">1</span></span>) color: color</span>;
    }

}
<span class="hljs-comment">//Species node agent that will represent the SIR Ordinary differential equations system</span>
species node_agent {
    <span class="hljs-keyword">float</span> t;
    <span class="hljs-keyword">float</span> I;
    <span class="hljs-keyword">float</span> S;
    <span class="hljs-keyword">float</span> R;
    equation eqSIR type: SIR vars: [S, I, R, t] <span class="hljs-keyword">params</span>: [N, beta, gamma];
    reflex solving {solve eqSIR method: rk4 step: <span class="hljs-number">1</span>;}
    
}

experiment Simulation_ABM_EBM type: gui {
    parameter <span class="hljs-string">'Number of Susceptible'</span> type: <span class="hljs-keyword">int</span> <span class="hljs-keyword">var</span>: number_S &lt;- <span class="hljs-number">495</span> category: <span class="hljs-string">"Initial population"</span>;
    parameter <span class="hljs-string">'Number of Infected'</span> type: <span class="hljs-keyword">int</span> <span class="hljs-keyword">var</span>: number_I &lt;- <span class="hljs-number">5</span> category: <span class="hljs-string">"Initial population"</span>;
    parameter <span class="hljs-string">'Number of Removed'</span> type: <span class="hljs-keyword">int</span> <span class="hljs-keyword">var</span>: number_R &lt;- <span class="hljs-number">0</span> category: <span class="hljs-string">"Initial population"</span>;
    parameter <span class="hljs-string">'Beta (S-&gt;I)'</span> type: <span class="hljs-keyword">float</span> <span class="hljs-keyword">var</span>: beta &lt;- <span class="hljs-number">0.1</span> category: <span class="hljs-string">"Parameters"</span>;
    parameter <span class="hljs-string">'Gamma (I-&gt;R)'</span> type: <span class="hljs-keyword">float</span> <span class="hljs-keyword">var</span>: gamma &lt;- <span class="hljs-number">0.01</span> category: <span class="hljs-string">"Parameters"</span>;
    parameter <span class="hljs-string">'Size of the neighbours'</span> type: <span class="hljs-keyword">int</span> <span class="hljs-keyword">var</span>: neighbours_size &lt;- <span class="hljs-number">1</span> min: <span class="hljs-number">1</span> max: <span class="hljs-number">5</span> category: <span class="hljs-string">"Infection"</span>;
    output {
        display sir_display { 
            grid sir_grid lines: <span class="hljs-meta">#black;</span>
            species Host aspect: basic; 
        }
        display ABM { 
            chart <span class="hljs-string">'Susceptible'</span> type: series background: <span class="hljs-meta">#lightgray style: exploded {</span>
                data <span class="hljs-string">'susceptible'</span> <span class="hljs-keyword">value</span>: (Host <span class="hljs-keyword">as</span> list) count (each.is_susceptible) color: <span class="hljs-meta">#green;</span>
                data <span class="hljs-string">'infected'</span> <span class="hljs-keyword">value</span>: (Host <span class="hljs-keyword">as</span> list) count (each.is_infected) color: <span class="hljs-meta">#red;</span>
                data <span class="hljs-string">'immune'</span> <span class="hljs-keyword">value</span>: (Host <span class="hljs-keyword">as</span> list) count (each.is_immune) color: <span class="hljs-meta">#blue;</span>
            }
        }
        display EBM { 
            chart <span class="hljs-string">"SIR"</span> type: series background: <span class="hljs-meta">#white {</span>
                data <span class="hljs-string">'S'</span> <span class="hljs-keyword">value</span>: first(node_agent).S color: <span class="hljs-meta">#green;</span>
                data <span class="hljs-string">'I'</span> <span class="hljs-keyword">value</span>: first(node_agent).I color: <span class="hljs-meta">#red;</span>
                data <span class="hljs-string">'R'</span> <span class="hljs-keyword">value</span>: first(node_agent).R color: <span class="hljs-meta">#blue;</span>
            }
        }
        display ABM_EBM  { 
            chart <span class="hljs-string">'Susceptible'</span> type: series background: <span class="hljs-meta">#lightgray style: exploded {</span>
                data <span class="hljs-string">'susceptible'</span> <span class="hljs-keyword">value</span>: (Host <span class="hljs-keyword">as</span> list) count (each.is_susceptible) color: <span class="hljs-meta">#green-50;</span>
                data <span class="hljs-string">'infected'</span> <span class="hljs-keyword">value</span>: (Host <span class="hljs-keyword">as</span> list) count (each.is_infected) color: <span class="hljs-meta">#red-50;</span>
                data <span class="hljs-string">'immune'</span> <span class="hljs-keyword">value</span>: (Host <span class="hljs-keyword">as</span> list) count (each.is_immune) color: <span class="hljs-meta">#blue-50;</span>
                data <span class="hljs-string">'S'</span> <span class="hljs-keyword">value</span>: first(node_agent).S color: <span class="hljs-meta">#green+50;</span>
                data <span class="hljs-string">'I'</span> <span class="hljs-keyword">value</span>: first(node_agent).I color: <span class="hljs-meta">#red+50;</span>
                data <span class="hljs-string">'R'</span> <span class="hljs-keyword">value</span>: first(node_agent).R color: <span class="hljs-meta">#blue+50;</span>
            }
        }
    }

}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>