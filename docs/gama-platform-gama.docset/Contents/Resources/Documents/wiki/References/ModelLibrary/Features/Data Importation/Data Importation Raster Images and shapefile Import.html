<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Features/Data Importation/Data Importation Raster Images and shapefile Import --><head><meta charset="utf-8"><title>Data Importation Raster Images and shapefile Import</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="data-importation-raster-images-and-shapefile-import">Data Importation Raster Images and shapefile Import</h1>
<h1 id="raster-file-and-shapefiles-import">Raster File and Shapefiles Import</h1>
<p><em>Author : Maroussia Vavasseur and Benoit Gaudou</em></p>
<p>Model which imports data from a raster file and two shapefiles to initilalize a grid and two species. The roaster file initialize a grid attribute for the cells and the shapefiles a river species just with the same shape, and the managementUnit species with a link between the columns of the shapefile and the attributes of the species. </p>
<p>Code of the model : </p>
<pre><code class="hljs mel">
model RasterAndShapefiles


 
<span class="hljs-keyword">global</span> {
    <span class="hljs-comment">// Constants</span>
    <span class="hljs-keyword">int</span> heightImg const: true &lt;- <span class="hljs-number">5587</span>;
    <span class="hljs-keyword">int</span> widthImg const: true &lt;- <span class="hljs-number">6201</span>;   
    <span class="hljs-keyword">file</span> boundsMNT const: true &lt;- <span class="hljs-keyword">file</span>(<span class="hljs-string">"../images/mnt/boundsMNT.shp"</span>); 
    
    
<span class="hljs-comment">// The environment bounds are defined using the hand-made boundsMNT shapefile.</span>
<span class="hljs-comment">// This shapefile has been created as a georeferenced bounding box of the MNT raster image, using information of the .pgw file</span>
    geometry shape &lt;- envelope(boundsMNT);
    
    <span class="hljs-comment">// Global variables related to the MNT</span>
    <span class="hljs-keyword">file</span> mntImageRaster &lt;- image_file(<span class="hljs-string">'../images/mnt/testAG.jpg'</span>) ;
    <span class="hljs-keyword">int</span> factorDiscret  &lt;- <span class="hljs-number">10</span>;
    
    <span class="hljs-comment">// Global variables  related to the Management units    </span>
    <span class="hljs-keyword">file</span> ManagementUnitShape &lt;- <span class="hljs-keyword">file</span>(<span class="hljs-string">'../images/ug/UGSelect.shp'</span>);
    
    <span class="hljs-comment">// Global variables  related to the water network</span>
    <span class="hljs-keyword">file</span> waterShape &lt;- <span class="hljs-keyword">file</span>(<span class="hljs-string">'../images/reseauHydro/reseauEau.shp'</span>);

    <span class="hljs-comment">// Global variables  related to izard agents</span>
    <span class="hljs-keyword">int</span> nbIzard &lt;- <span class="hljs-number">25</span> ;
    <span class="hljs-keyword">file</span> izardShape &lt;-<span class="hljs-keyword">file</span>(<span class="hljs-string">'../images/icons/izard.gif'</span>) ;
        
    <span class="hljs-comment">// Initialization of grid and creation of the izard agents.</span>
    <span class="hljs-comment">// Creation of managmentUnit and rivers agents from the corresponding shapefile</span>
    init {
        create managementUnit from: ManagementUnitShape 
                with: [MUcode::<span class="hljs-keyword">int</span>(read(<span class="hljs-string">'Code_UG'</span>)), MULabel::<span class="hljs-keyword">string</span>(read(<span class="hljs-string">'Libelle_UG'</span>)), pgeSAGE::<span class="hljs-keyword">string</span>(read(<span class="hljs-string">'PGE_SAGE'</span>))] ;
                
        create river from: waterShape;
                
        <span class="hljs-keyword">matrix</span>&lt;<span class="hljs-keyword">int</span>&gt; mapColor &lt;- <span class="hljs-keyword">matrix</span>&lt;<span class="hljs-keyword">int</span>&gt;(mntImageRaster as_matrix {widthImg/factorDiscret,heightImg/factorDiscret}) ;
        ask cell {      
            <span class="hljs-keyword">color</span> &lt;- rgb( mapColor at {grid_x,grid_y} );
        }
        create izard number: nbIzard;           
    }
}

species river {
    aspect <span class="hljs-keyword">default</span>{
        draw shape <span class="hljs-keyword">color</span>: #blue;
    }   
}

species managementUnit{
    <span class="hljs-keyword">int</span> MUcode;
    <span class="hljs-keyword">string</span> MULabel;
    <span class="hljs-keyword">string</span> pgeSAGE;
    
    aspect <span class="hljs-keyword">default</span>{
        draw shape;
    }
}   
species izard { 
    init{
        location &lt;- (shuffle(cell) first_with ((each.<span class="hljs-keyword">color</span> != #white) and (empty(izard inside each)))).location ;
    }   
    aspect <span class="hljs-keyword">default</span>{
        draw square(<span class="hljs-number">5000</span>) <span class="hljs-keyword">color</span>: #orange;
    }
    aspect <span class="hljs-keyword">image</span>{
        draw izardShape <span class="hljs-keyword">size</span>: <span class="hljs-number">5000</span>;
    }
}   

<span class="hljs-comment">// We create a grid as environment with the same dimensions as the matrix in which we want to store the image</span>

<span class="hljs-keyword">grid</span> cell width: widthImg/factorDiscret height: heightImg/factorDiscret;



experiment main type: gui {
    
    <span class="hljs-comment">// We display:</span>
    <span class="hljs-comment">// - the original MNT image as background</span>
    <span class="hljs-comment">// - the grid representing the MNT</span>
    <span class="hljs-comment">// - izard agents</span>
    <span class="hljs-comment">// - the management unit shapefile</span>
    <span class="hljs-comment">// - the river shapefile</span>
    <span class="hljs-comment">// We can thus compare the original MNT image and the discretized image in the grid.</span>
    <span class="hljs-comment">// For cosmetic need, we can choose to not display the grid. </span>
    output {
        display HowToImportVectorial {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'Background'</span> <span class="hljs-keyword">file</span>: mntImageRaster.path;       
            <span class="hljs-keyword">grid</span> cell;
            species managementUnit transparency: <span class="hljs-number">0.5</span>;
            species river ;
            species izard aspect: <span class="hljs-keyword">image</span>;  
        }
    }
}

</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>