<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Features/Agent movement/Agent movement Goto Polygon --><head><meta charset="utf-8"><title>Agent movement Goto Polygon</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="agent-movement-goto-polygon">Agent movement Goto Polygon</h1>
<h1 id="movement-on-a-graph-created-by-polygons">Movement on a Graph created by Polygons</h1>
<p><em>Author :  Patrick Taillandier</em></p>
<p>Model to show how to create a graph using a polygon shapefile by skeletonizing it, and creating roads using the skeleton. All of the agents will use this graph to go to the same targeted location.</p>
<p>Code of the model : </p>
<pre><code class="hljs processing">
model polygon
global {
    <span class="hljs-comment">//Import of the shapefile containing the different polygons</span>
    file shape_file_in &lt;- file(<span class="hljs-string">'../includes/gis/squareHole.shp'</span>) ;
    graph the_graph;
    
    geometry <span class="hljs-built_in">shape</span> &lt;- envelope(shape_file_in);
    
    init {    
        create object from: shape_file_in ;
        object the_object &lt;- first(object);
        
        <span class="hljs-comment">//triangulation of the object to get the different triangles of the polygons</span>
        list&lt;geometry&gt; triangles &lt;- list(triangulate(the_object));
        
        <span class="hljs-built_in">loop</span> trig over: triangles {
            create triangle_obj {
                <span class="hljs-built_in">shape</span> &lt;- trig;
            }
        }
        
        <span class="hljs-comment">//creation of a list of skeleton from the object </span>
        list&lt;geometry&gt; skeletons &lt;- list(skeletonize(the_object));
        
        <span class="hljs-comment">//Split of the skeletons list according to their intersection points</span>
        list&lt;geometry&gt; skeletons_split  &lt;- split_lines(skeletons);
        <span class="hljs-built_in">loop</span> sk over: skeletons_split {
            create skeleton {
                <span class="hljs-built_in">shape</span> &lt;- sk;
            }
        }
        
        <span class="hljs-comment">//Creation of the graph using the edges resulting of the splitted skeleton</span>
         the_graph &lt;- as_edge_graph(skeleton);
         
         
        create goal  {
             location &lt;- any_location_in (one_of(skeleton)); 
        }
        create people number: <span class="hljs-number">100</span> {
             target &lt;- one_of (goal) ; 
             location &lt;- any_location_in (one_of(skeleton));
        } 
    }
}

species object  {
    aspect <span class="hljs-keyword">default</span> {
        <span class="hljs-title">draw</span> <span class="hljs-built_in">shape</span> <span class="hljs-built_in">color</span>: #gray ;
    }
}

species triangle_obj  {
    rgb <span class="hljs-built_in">color</span> &lt;- rgb(<span class="hljs-number">150</span> +rnd(<span class="hljs-number">100</span>),<span class="hljs-number">150</span> + rnd(<span class="hljs-number">100</span>),<span class="hljs-number">150</span> + rnd(<span class="hljs-number">100</span>));
    aspect <span class="hljs-keyword">default</span> {
        <span class="hljs-title">draw</span> <span class="hljs-built_in">shape</span> <span class="hljs-built_in">color</span>: <span class="hljs-built_in">color</span> ; 
    }
}

species skeleton  {
    aspect <span class="hljs-keyword">default</span> {
        <span class="hljs-title">draw</span> <span class="hljs-built_in">shape</span> + <span class="hljs-number">0.2</span> <span class="hljs-built_in">color</span>: #<span class="hljs-built_in">red</span> ;
    }
}
    
species goal {
    aspect <span class="hljs-keyword">default</span> {
        <span class="hljs-title">draw</span> circle(<span class="hljs-number">3</span>) <span class="hljs-built_in">color</span>:#<span class="hljs-built_in">red</span>;
    }
}

species people skills: [moving] {
    goal target;
    path my_path; 
    
    reflex goto {
        do goto on:the_graph target:target speed:<span class="hljs-number">1</span>;
    }
    aspect <span class="hljs-keyword">default</span> {
        <span class="hljs-title">draw</span> circle(<span class="hljs-number">3</span>) <span class="hljs-built_in">color</span>: #<span class="hljs-built_in">green</span>;
    }
}

experiment goto_polygon type: gui {
    output {
        display objects_display {
            species object aspect: <span class="hljs-keyword">default</span> ;
            species triangle_obj aspect: <span class="hljs-keyword">default</span> ;
            species skeleton aspect: <span class="hljs-keyword">default</span> ;
            species people aspect: <span class="hljs-keyword">default</span> ;
            species goal aspect: <span class="hljs-keyword">default</span> ;
        }
    }
}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>