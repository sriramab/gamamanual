<html><!-- Online page at https://github.com/gama-platform/gama/wiki/References/ModelLibrary/Features/Co-model Usage/Co-model Usage comodel_mix_behaviors --><head><meta charset="utf-8"><title>Co model Usage comodel_mix_behaviors</title><script src="../../../../../dash_resources/highlight.all.js"></script><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/github-markdown.css"><link rel="stylesheet" type="text/css" href="../../../../../dash_resources/highlightjs.github.css"></head><body class="markdown-body" style="padding-bottom:20px; margin: 8px 13px;"><h1 id="co-model-usage-comodel_mix_behaviors">Co model Usage comodel_mix_behaviors</h1>
<h1 id="comodel-with-mixed-behaviors">comodel with mixed behaviors</h1>
<p><em>Author : HUYNH Quang Nghi</em></p>
<p>This is a simple comodel serve to demonstrate the mixing behaviors of preyPredator with the Ants. Ants are the prey, fleeing from Predators, when they are not chasing, they try to do job of the ants.</p>
<p>Imported models : </p>
<pre><code class="hljs processing">model ants

global {
    <span class="hljs-comment">//Evaporation value per cycle</span>
    <span class="hljs-built_in">float</span> evaporation_per_cycle &lt;- <span class="hljs-number">5.0</span> <span class="hljs-built_in">min</span>: <span class="hljs-number">0.0</span> <span class="hljs-built_in">max</span>: <span class="hljs-number">240.0</span> parameter: <span class="hljs-string">'Evaporation of the signal (unit/cycle):'</span> category: <span class="hljs-string">'Signals'</span>;
    <span class="hljs-comment">//Diffusion rate of the pheromon among the grid</span>
    <span class="hljs-built_in">float</span> diffusion_rate &lt;- <span class="hljs-number">1.0</span> <span class="hljs-built_in">min</span>: <span class="hljs-number">0.0</span> <span class="hljs-built_in">max</span>: <span class="hljs-number">1.0</span> parameter: <span class="hljs-string">'Rate of diffusion of the signal (%/cycle):'</span> category: <span class="hljs-string">'Signals'</span>;
    <span class="hljs-comment">//Size of the grid</span>
    <span class="hljs-built_in">int</span> gridsize &lt;- <span class="hljs-number">100</span> <span class="hljs-built_in">min</span>: <span class="hljs-number">30</span> parameter: <span class="hljs-string">'Width and Height of the grid:'</span> category: <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-comment">//Number of ants</span>
    <span class="hljs-built_in">int</span> ants_number &lt;- <span class="hljs-number">200</span> <span class="hljs-built_in">min</span>: <span class="hljs-number">1</span> parameter: <span class="hljs-string">'Number of ants:'</span> category: <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-comment">//Frequency of update of the grid</span>
    <span class="hljs-built_in">int</span> grid_frequency &lt;- <span class="hljs-number">1</span> <span class="hljs-built_in">min</span>: <span class="hljs-number">1</span> <span class="hljs-built_in">max</span>: <span class="hljs-number">100</span> parameter: <span class="hljs-string">'Grid updates itself every:'</span> category: <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-comment">//Number of food places among the grid</span>
    <span class="hljs-built_in">int</span> number_of_food_places &lt;- <span class="hljs-number">5</span> <span class="hljs-built_in">min</span>: <span class="hljs-number">1</span> parameter: <span class="hljs-string">'Number of food depots:'</span> category: <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-built_in">float</span> grid_transparency &lt;- <span class="hljs-number">1.0</span>;
    file ant_shape_empty <span class="hljs-keyword">const</span>: <span class="hljs-keyword">true</span> &lt;- file(<span class="hljs-string">'../icons/ant.png'</span>);
    image_file ant_shape_full <span class="hljs-keyword">const</span>: <span class="hljs-keyword">true</span> &lt;- file(<span class="hljs-string">'../icons/full_ant.png'</span>);
    <span class="hljs-comment">//The center of the grid that will be considered as the nest location</span>
    <span class="hljs-built_in">point</span> center <span class="hljs-keyword">const</span>: <span class="hljs-keyword">true</span> &lt;- { <span class="hljs-built_in">round</span>(gridsize / <span class="hljs-number">2</span>), <span class="hljs-built_in">round</span>(gridsize / <span class="hljs-number">2</span>) };
    <span class="hljs-built_in">int</span> food_gathered &lt;- <span class="hljs-number">1</span>;
    <span class="hljs-built_in">int</span> food_placed &lt;- <span class="hljs-number">1</span>;
    rgb <span class="hljs-built_in">background</span> <span class="hljs-keyword">const</span>: <span class="hljs-keyword">true</span> &lt;- rgb(#<span class="hljs-number">99</span>CC66);
    rgb food_color <span class="hljs-keyword">const</span>: <span class="hljs-keyword">true</span> &lt;- rgb(#<span class="hljs-number">312200</span>);
    rgb nest_color <span class="hljs-keyword">const</span>: <span class="hljs-keyword">true</span> &lt;- rgb(#<span class="hljs-number">000000</span>); 

    geometry <span class="hljs-built_in">shape</span> &lt;- square(gridsize);
    init {
        <span class="hljs-comment">//Creation of the food places placed randomly with a certain distance between each</span>
        <span class="hljs-built_in">loop</span> times: number_of_food_places {
            <span class="hljs-built_in">point</span> loc &lt;- { rnd(gridsize - <span class="hljs-number">10</span>) + <span class="hljs-number">5</span>, rnd(gridsize - <span class="hljs-number">10</span>) + <span class="hljs-number">5</span> };
            list&lt;ant_grid&gt; food_places &lt;- (ant_grid where ((each distance_to loc) &lt; <span class="hljs-number">5</span>));
            ask food_places {
                <span class="hljs-keyword">if</span> food = <span class="hljs-number">0</span> {
                    food &lt;- <span class="hljs-number">5</span>;
                    food_placed &lt;- food_placed + <span class="hljs-number">5</span>;
                    <span class="hljs-built_in">color</span> &lt;- food_color;  
                }                                           
            }
        }
        <span class="hljs-comment">//Creation of the ants that will be placed in the nest</span>
        create ant number: ants_number with: (location: center);
    }
    <span class="hljs-comment">//Reflex to diffuse the pheromon among the grid</span>
    reflex diffuse {
      diffuse var:road on:ant_grid proportion: diffusion_rate radius:<span class="hljs-number">3</span> propagation: gradient method:convolution;
   }
  
}

<span class="hljs-comment">//Grid used to discretize the space to place food</span>
grid ant_grid <span class="hljs-built_in">width</span>: gridsize <span class="hljs-built_in">height</span>: gridsize neighbors: <span class="hljs-number">8</span> frequency: grid_frequency use_regular_agents: <span class="hljs-keyword">false</span> use_individual_shapes: <span class="hljs-keyword">false</span>{
    bool is_nest <span class="hljs-keyword">const</span>: <span class="hljs-keyword">true</span> &lt;- (topology(ant_grid) distance_between [self, center]) &lt; <span class="hljs-number">4</span>;
    <span class="hljs-built_in">float</span> road &lt;- <span class="hljs-number">0.0</span> <span class="hljs-built_in">max</span>: <span class="hljs-number">240.0</span> update: (road &lt;= evaporation_per_cycle) ? <span class="hljs-number">0.0</span> : road - evaporation_per_cycle;
    rgb <span class="hljs-built_in">color</span> &lt;- is_nest ? nest_color : ((food &gt; <span class="hljs-number">0</span>) ? food_color : ((road &lt; <span class="hljs-number">0.001</span>) ? <span class="hljs-built_in">background</span> : rgb(#<span class="hljs-number">009900</span>) + <span class="hljs-built_in">int</span>(road * <span class="hljs-number">5</span>))) update: is_nest ? nest_color : ((food &gt; <span class="hljs-number">0</span>) ?
    food_color : ((road &lt; <span class="hljs-number">0.001</span>) ? <span class="hljs-built_in">background</span> : rgb(#<span class="hljs-number">009900</span>) + <span class="hljs-built_in">int</span>(road * <span class="hljs-number">5</span>)));
    <span class="hljs-built_in">int</span> food &lt;- <span class="hljs-number">0</span>;
}
<span class="hljs-comment">//Species ant that will move and follow a final state machine</span>
species ant skills: [moving] control: fsm {
    <span class="hljs-built_in">float</span> speed &lt;- <span class="hljs-number">1.0</span>;
    bool has_food &lt;- <span class="hljs-keyword">false</span>;
    
    <span class="hljs-comment">//Reflex to place a pheromon stock in the cell</span>
    reflex diffuse_road when:has_food=<span class="hljs-keyword">true</span>{
      ant_grid(location).road &lt;- ant_grid(location).road + <span class="hljs-number">100.0</span>;
   }
    <span class="hljs-comment">//Action to pick food</span>
    action pick (<span class="hljs-built_in">int</span> amount) {
        has_food &lt;- <span class="hljs-keyword">true</span>;
        ant_grid place &lt;- ant_grid(location);
        place.food &lt;- place.food - amount;
    }
    <span class="hljs-comment">//Action to drop food</span>
    action drop {
        food_gathered &lt;- food_gathered + <span class="hljs-number">1</span>;
        has_food &lt;- <span class="hljs-keyword">false</span>;
        heading &lt;- heading - <span class="hljs-number">180</span>;
    }
    <span class="hljs-comment">//Action to find the best place in the neighborhood cells</span>
    <span class="hljs-built_in">point</span> choose_best_place {
        container list_places &lt;- ant_grid(location).neighbors;
        <span class="hljs-keyword">if</span> (list_places count (each.food &gt; <span class="hljs-number">0</span>)) &gt; <span class="hljs-number">0</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">point</span>(list_places first_with (each.food &gt; <span class="hljs-number">0</span>));
        } <span class="hljs-keyword">else</span> {
            list_places &lt;- (list_places where ((each.road &gt; <span class="hljs-number">0</span>) and ((each distance_to center) &gt; (self distance_to center)))) sort_by (each.road);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">point</span>(last(list_places));
        }

    }
    <span class="hljs-comment">//Reflex to drop food once the ant is in the nest</span>
    reflex drop when: has_food and (ant_grid(location)).is_nest {
        do drop();
    }
    <span class="hljs-comment">//Reflex to pick food when there is one at the same location</span>
    reflex pick when: !has_food and (ant_grid(location)).food &gt; <span class="hljs-number">0</span> {
        do pick(<span class="hljs-number">1</span>);
    }
    <span class="hljs-comment">//Initial state to make the ant wander </span>
    state wandering initial: <span class="hljs-keyword">true</span> {
        do wander(amplitude: <span class="hljs-number">90</span>);
        <span class="hljs-built_in">float</span> pr &lt;- (ant_grid(location)).road;
        transition to: carryingFood when: has_food;
        transition to: followingRoad when: (pr &gt; <span class="hljs-number">0.05</span>) and (pr &lt; <span class="hljs-number">4</span>);
    }
    <span class="hljs-comment">//State to carry food once it has been found</span>
    state carryingFood {
        do goto(target: center);
        transition to: wandering when: !has_food;
    }
    <span class="hljs-comment">//State to follow a pheromon road if once has been found</span>
    state followingRoad {
        <span class="hljs-built_in">point</span> next_place &lt;- choose_best_place();
        <span class="hljs-built_in">float</span> pr &lt;- (ant_grid(location)).road;
        location &lt;- next_place;
        transition to: carryingFood when: has_food;
        transition to: wandering when: (pr &lt; <span class="hljs-number">0.05</span>) or (next_place = nil);
    }

    aspect info {
        <span class="hljs-title">draw</span> circle(<span class="hljs-number">1</span>) empty: !has_food <span class="hljs-built_in">color</span>: #<span class="hljs-built_in">red</span>;
        <span class="hljs-keyword">if</span> (destination != nil) {
            <span class="hljs-title">draw</span> <span class="hljs-built_in">line</span>([location + {<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>}, destination + {<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>}]) + <span class="hljs-number">0.1</span> <span class="hljs-built_in">color</span>: #white border: <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-title">draw</span> circle(<span class="hljs-number">4</span>) empty: <span class="hljs-keyword">true</span> <span class="hljs-built_in">color</span>: #white;
        <span class="hljs-title">draw</span> string(self as <span class="hljs-built_in">int</span>) <span class="hljs-built_in">color</span>: #white font: font(<span class="hljs-string">"Helvetica"</span>, <span class="hljs-number">12</span> * #zoom, #bold) at: my location - {<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">-0.5</span>};
        <span class="hljs-title">draw</span> state <span class="hljs-built_in">color</span>: #yellow  font: font(<span class="hljs-string">"Helvetica"</span>, <span class="hljs-number">10</span> * #zoom, #plain) at: my location + { <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.5</span> } <span class="hljs-built_in">perspective</span>: <span class="hljs-keyword">false</span>;
    }

    aspect icon {
        <span class="hljs-title">draw</span> ant_shape_empty <span class="hljs-built_in">size</span>: {<span class="hljs-number">7</span>,<span class="hljs-number">5</span>} <span class="hljs-built_in">rotate</span>: my heading + <span class="hljs-number">1</span>;
    }

    aspect <span class="hljs-keyword">default</span> {
        <span class="hljs-title">draw</span> square(<span class="hljs-number">1</span>) empty: !has_food <span class="hljs-built_in">color</span>: #<span class="hljs-built_in">blue</span> <span class="hljs-built_in">rotate</span>: my heading;
    }
}   
<span class="hljs-comment">//Simple experiment to display the ants</span>
experiment Displays type: gui {
    <span class="hljs-built_in">point</span> quadrant_size &lt;- { <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span> };
    <span class="hljs-built_in">float</span> inc &lt;- <span class="hljs-number">0.001</span>;
    <span class="hljs-built_in">float</span> pos &lt;- <span class="hljs-number">0.0</span>;
    reflex moving_quadrant {
    <span class="hljs-comment">//pos &lt;- pos + inc;</span>
        <span class="hljs-keyword">if</span> (pos &gt; <span class="hljs-number">0.5</span> or pos &lt;= <span class="hljs-number">0</span>) {
            inc &lt;- -inc;
        }
        
    }

    output {
        display Ants <span class="hljs-built_in">background</span>: #white type: opengl {
            <span class="hljs-built_in">image</span> <span class="hljs-string">'../images/soil.jpg'</span> position: { pos, pos } <span class="hljs-built_in">size</span>: quadrant_size;
            agents <span class="hljs-string">"agents"</span> transparency: <span class="hljs-number">0.5</span> position: { pos, pos } <span class="hljs-built_in">size</span>: quadrant_size value: (ant_grid as list) where ((each.food &gt; <span class="hljs-number">0</span>) or (each.road &gt; <span class="hljs-number">0</span>) or (each.is_nest));
            species ant position: { pos, pos } <span class="hljs-built_in">size</span>: quadrant_size aspect: icon;
            grid ant_grid lines: #darkgray position: { <span class="hljs-number">0.5</span>, <span class="hljs-number">0</span> } <span class="hljs-built_in">size</span>: quadrant_size;
            species ant position: { <span class="hljs-number">0.5</span>, <span class="hljs-number">0</span> } <span class="hljs-built_in">size</span>: quadrant_size aspect: info;
        }
    }
}
<span class="hljs-comment">//Complete experiment that will inspect all ants in a table</span>
experiment Complete type: gui {
    parameter <span class="hljs-string">'Number:'</span> var: ants_number init: <span class="hljs-number">100</span> unit: <span class="hljs-string">'ants'</span> category: <span class="hljs-string">'Environment and Population'</span>;
    parameter <span class="hljs-string">'Grid dimension:'</span> var: gridsize init: <span class="hljs-number">100</span> unit: <span class="hljs-string">'(number of rows and columns)'</span> category: <span class="hljs-string">'Environment and Population'</span>;
    parameter <span class="hljs-string">'Number of food depots:'</span> var: number_of_food_places init: <span class="hljs-number">5</span> <span class="hljs-built_in">min</span>: <span class="hljs-number">1</span> category: <span class="hljs-string">'Environment and Population'</span>;

    <span class="hljs-comment">// Experimentator</span>

    init {
        write <span class="hljs-string">"Experimentator agent running "</span> + self;
       ants_number &lt;- <span class="hljs-number">200</span>;
    }


    output {
        display Ants2D type: java2D {
            <span class="hljs-built_in">image</span> <span class="hljs-string">'../images/soil.jpg'</span> position: { <span class="hljs-number">0.05</span>, <span class="hljs-number">0.05</span> } <span class="hljs-built_in">size</span>: { <span class="hljs-number">0.9</span>, <span class="hljs-number">0.9</span> };
            agents <span class="hljs-string">"agents"</span> transparency: <span class="hljs-number">0.7</span> position: { <span class="hljs-number">0.05</span>, <span class="hljs-number">0.05</span> } <span class="hljs-built_in">size</span>: { <span class="hljs-number">0.9</span>, <span class="hljs-number">0.9</span> } value: (ant_grid as list) where ((each.food &gt; <span class="hljs-number">0</span>) or (each.road &gt; <span class="hljs-number">0</span>) or (each.is_nest)) ;
            species ant position: { <span class="hljs-number">0.05</span>, <span class="hljs-number">0.05</span> } <span class="hljs-built_in">size</span>: { <span class="hljs-number">0.9</span>, <span class="hljs-number">0.9</span> } aspect: icon;
            overlay <span class="hljs-string">"Texts"</span> transparency: <span class="hljs-number">0.3</span> <span class="hljs-built_in">background</span>: rgb (<span class="hljs-number">99</span>, <span class="hljs-number">85</span>, <span class="hljs-number">66</span>,<span class="hljs-number">255</span>)  position: {<span class="hljs-number">10</span>°px, <span class="hljs-number">10</span>°px} <span class="hljs-built_in">size</span>: {<span class="hljs-number">250</span>°px, <span class="hljs-number">150</span>°px} border: rgb (<span class="hljs-number">99</span>, <span class="hljs-number">85</span>, <span class="hljs-number">66</span>,<span class="hljs-number">255</span>) rounded: <span class="hljs-keyword">true</span>{
                <span class="hljs-title">draw</span> ant_shape_full at: {<span class="hljs-number">60</span>°px, <span class="hljs-number">70</span>°px} <span class="hljs-built_in">size</span>: {<span class="hljs-number">140</span>°px, <span class="hljs-number">100</span>°px} <span class="hljs-built_in">rotate</span>: <span class="hljs-number">-60</span>;
                <span class="hljs-title">draw</span> (<span class="hljs-string">'Food foraged: '</span> + (((food_placed = <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : food_gathered / food_placed) * <span class="hljs-number">100</span>) with_precision <span class="hljs-number">2</span>) + <span class="hljs-string">'%'</span>) at: {<span class="hljs-number">40</span>°px,<span class="hljs-number">70</span>°px} font:font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">18</span>, #bold) <span class="hljs-built_in">color</span>: #white;
                <span class="hljs-title">draw</span> (<span class="hljs-string">'Carrying ants: '</span> + (((<span class="hljs-number">100</span> * ant count (each.has_food or each.state = <span class="hljs-string">"followingRoad"</span>)) / length(ant)) with_precision <span class="hljs-number">2</span>) + <span class="hljs-string">'%'</span>) at: {<span class="hljs-number">40</span>°px, <span class="hljs-number">100</span>°px} font:font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">18</span> , #bold) <span class="hljs-built_in">color</span>: #white;
            }
                    
        }
        inspect <span class="hljs-string">"All ants"</span> type: table value: ant attributes: [<span class="hljs-string">'name'</span>, <span class="hljs-string">'location'</span>, <span class="hljs-string">'heading'</span>,<span class="hljs-string">'state'</span>];
    }
}
<span class="hljs-comment">//Batch experiment to find the best way to maximize the food gathered using exhaustive method</span>
experiment Batch type: batch repeat: <span class="hljs-number">4</span> keep_seed: <span class="hljs-keyword">true</span> until: (food_gathered = food_placed) or (time &gt; <span class="hljs-number">1000</span>) {
    parameter <span class="hljs-string">'Size of the grid:'</span> var: gridsize init: <span class="hljs-number">75</span> unit: <span class="hljs-string">'width and height'</span>;
    parameter <span class="hljs-string">'Number:'</span> var: ants_number among:[<span class="hljs-number">10</span>,<span class="hljs-number">20</span>,<span class="hljs-number">50</span>] unit: <span class="hljs-string">'ants'</span>;
    parameter  <span class="hljs-string">'Evaporation:'</span> var: evaporation_per_cycle among: [<span class="hljs-number">0.1</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">10.0</span>] unit: <span class="hljs-string">'units every cycle'</span>;
    parameter  <span class="hljs-string">'Diffusion:'</span> var: diffusion_rate <span class="hljs-built_in">min</span>: <span class="hljs-number">0.1</span> <span class="hljs-built_in">max</span>: <span class="hljs-number">1.0</span> unit: <span class="hljs-string">'rate every cycle (1.0 means 100%)'</span> step: <span class="hljs-number">0.2</span>;
    method exhaustive maximize: food_gathered;

    
    permanent {
        display Comparison <span class="hljs-built_in">background</span>: #white {
            chart <span class="hljs-string">"Food Gathered"</span> type: series {
                    data <span class="hljs-string">"Min"</span> value:  <span class="hljs-built_in">min</span>(ants_model collect each.food_gathered ) style: spline <span class="hljs-built_in">color</span>: #darkgreen ;
                    data <span class="hljs-string">"Max"</span> value:  <span class="hljs-built_in">max</span>(ants_model collect each.food_gathered ) style: spline <span class="hljs-built_in">color</span>: #<span class="hljs-built_in">red</span> ;
            }
        }
    }
}

<span class="hljs-comment">//Batch experiment to find the best way to maximize the food gathered using genetic method</span>
experiment Genetic type: batch repeat: <span class="hljs-number">2</span> keep_seed: <span class="hljs-keyword">true</span> until: (food_gathered = food_placed) or (time &gt; <span class="hljs-number">1000</span>) {
    parameter <span class="hljs-string">'Size of the grid:'</span> var: gridsize init: <span class="hljs-number">75</span> unit: <span class="hljs-string">'(width and height)'</span>;
    parameter <span class="hljs-string">'Number:'</span> var: ants_number among:[<span class="hljs-number">10</span>,<span class="hljs-number">20</span>,<span class="hljs-number">50</span>] unit: <span class="hljs-string">'ants'</span>;
    parameter  <span class="hljs-string">'Evaporation:'</span> var: evaporation_per_cycle among: [<span class="hljs-number">0.1</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">10.0</span>] unit: <span class="hljs-string">'units every cycle'</span>;
    parameter <span class="hljs-string">'Diffusion:'</span> var: diffusion_rate <span class="hljs-built_in">min</span>: <span class="hljs-number">0.1</span> <span class="hljs-built_in">max</span>: <span class="hljs-number">1.0</span> unit: <span class="hljs-string">'rate every cycle (1.0 means 100%)'</span> step: <span class="hljs-number">0.2</span>;
    method genetic maximize: food_gathered pop_dim: <span class="hljs-number">5</span> crossover_prob: <span class="hljs-number">0.7</span> mutation_prob: <span class="hljs-number">0.1</span> nb_prelim_gen: <span class="hljs-number">1</span> max_gen: <span class="hljs-number">20</span>;
    
        permanent {
        display Comparison <span class="hljs-built_in">background</span>: #white {
            chart <span class="hljs-string">"Food Gathered"</span> type: series {
                    data <span class="hljs-string">"Min"</span> value:  <span class="hljs-built_in">min</span>(ants_model collect each.food_gathered ) style: spline <span class="hljs-built_in">color</span>: #darkgreen ;
                    data <span class="hljs-string">"Max"</span> value:  <span class="hljs-built_in">max</span>(ants_model collect each.food_gathered ) style: spline <span class="hljs-built_in">color</span>: #<span class="hljs-built_in">red</span> ;
            }
        }
    }
}
</code></pre>
<pre><code class="hljs lasso">model Ants_coupling

<span class="hljs-keyword">import</span> <span class="hljs-string">"../../../Toy Models/Ants (Foraging and Sorting)/models/Ant Foraging (Complex).gaml"</span> 



experiment Ants_coupling_exp <span class="hljs-keyword">type</span>:gui  <span class="hljs-keyword">parent</span>:Complete{
    
    <span class="hljs-built_in">list</span>&lt;ant&gt; getAnts{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(ant);
    }
    
    <span class="hljs-built_in">list</span>&lt;ant_grid&gt; getAnt_grid{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(ant_grid);
    }
    
    output{ 
    }
}
</code></pre>
<pre><code class="hljs sqf">model PreyPredator
 global
{
    geometry shape &lt;- square(<span class="hljs-number">100</span>);
    float perceipt_radius &lt;- <span class="hljs-number">20.0</span>;
    int preyinit &lt;- <span class="hljs-number">500</span>;
    int predatorinit &lt;- <span class="hljs-number">3</span>;
    <span class="hljs-built_in">list</span>&lt;<span class="hljs-built_in">agent</span>&gt; lstPredator &lt;- <span class="hljs-built_in">list</span>&lt;<span class="hljs-built_in">agent</span>&gt;(predator);
    <span class="hljs-built_in">list</span>&lt;<span class="hljs-built_in">agent</span>&gt; lstPrey &lt;- <span class="hljs-built_in">list</span>&lt;<span class="hljs-built_in">agent</span>&gt;(prey);
    init
    {
        create prey number: preyinit;
        create predator number: predatorinit;
        lstPredator &lt;- <span class="hljs-built_in">list</span>&lt;<span class="hljs-built_in">agent</span>&gt;(predator);
        lstPrey &lt;- <span class="hljs-built_in">list</span>&lt;<span class="hljs-built_in">agent</span>&gt;(prey);
    }

}

species generic_species skills: [moving]
{
    float <span class="hljs-built_in">speed</span> &lt;- <span class="hljs-number">1.0</span>;
    point goal &lt;- <span class="hljs-literal">nil</span>;
    bool is_chased &lt;- <span class="hljs-literal">false</span>;
    reflex live_with_my_goal
    {
        <span class="hljs-keyword">if</span> (goal != <span class="hljs-literal">nil</span>)
        {
            <span class="hljs-keyword">do</span> wander <span class="hljs-built_in">speed</span>: <span class="hljs-built_in">speed</span>;
            <span class="hljs-keyword">do</span> <span class="hljs-built_in">goto</span> target: goal <span class="hljs-built_in">speed</span>: <span class="hljs-built_in">speed</span>;
        } <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">do</span> wander <span class="hljs-built_in">speed</span>: <span class="hljs-built_in">speed</span>;
        }

    }

}

species prey parent: generic_species
{
    geometry shape &lt;- circle(<span class="hljs-number">0.5</span>);
    float <span class="hljs-built_in">speed</span> &lt;- <span class="hljs-number">0.2</span>;
    rgb color &lt;- <span class="hljs-meta"># green;</span>
    reflex <span class="hljs-built_in">fleeing</span>
    {
        <span class="hljs-keyword">if</span> (length((lstPredator where (each != <span class="hljs-literal">nil</span> <span class="hljs-built_in">and</span> !dead(each) <span class="hljs-built_in">and</span> each distance_to self &lt; perceipt_radius))) &gt; <span class="hljs-number">0</span>)
        {
            <span class="hljs-built_in">speed</span> &lt;- <span class="hljs-number">1.0</span>;
            is_chased &lt;- <span class="hljs-literal">true</span>;
            color &lt;- <span class="hljs-meta"># lime;</span>
            <span class="hljs-keyword">if</span> (goal = <span class="hljs-literal">nil</span>)
            {
                <span class="hljs-built_in">agent</span> a &lt;- any(((lstPrey where (each != <span class="hljs-literal">nil</span> <span class="hljs-built_in">and</span> !dead(each) <span class="hljs-built_in">and</span> !generic_species(each).is_chased))));
                <span class="hljs-keyword">if</span> (a != <span class="hljs-literal">nil</span> <span class="hljs-built_in">and</span> !dead(a))
                {
                    <span class="hljs-keyword">if</span> (flip(<span class="hljs-number">0.5</span>))
                    {
                        goal &lt;- a.<span class="hljs-built_in">location</span>;
                    } <span class="hljs-keyword">else</span>
                    {
                        goal &lt;- any_location_in(world.shape);
                    }

                } <span class="hljs-keyword">else</span>
                {
                    goal &lt;- any_location_in(world.shape);
                }

            }

        }

        <span class="hljs-keyword">if</span> (goal != <span class="hljs-literal">nil</span> <span class="hljs-built_in">and</span> self.<span class="hljs-built_in">location</span> distance_to goal &lt; <span class="hljs-number">0.5</span>)
        {
            goal &lt;- <span class="hljs-literal">nil</span>;
        }

        <span class="hljs-keyword">if</span> (length((lstPredator where (each != <span class="hljs-literal">nil</span> <span class="hljs-built_in">and</span> !dead(each))) where (each distance_to self &lt;= perceipt_radius)) = <span class="hljs-number">0</span>)
        {
            is_chased &lt;- <span class="hljs-literal">false</span>;
            color &lt;- <span class="hljs-meta"># green;</span>
            <span class="hljs-built_in">speed</span> &lt;- <span class="hljs-number">0.2</span>;
        }

    }

    aspect <span class="hljs-keyword">default</span>
    {
        draw shape color: color;
    }

}

species predator parent: generic_species
{
    geometry shape &lt;- triangle(<span class="hljs-number">2</span>);
    rgb color &lt;- <span class="hljs-meta"># red;</span>
    reflex hunting
    {
        <span class="hljs-keyword">if</span> (goal = <span class="hljs-literal">nil</span>)
        {
            <span class="hljs-built_in">list</span> tmp &lt;- (lstPrey where (!dead(each) <span class="hljs-built_in">and</span> each.shape distance_to self.shape &lt; perceipt_radius));
            <span class="hljs-keyword">if</span> (length(tmp) &gt; <span class="hljs-number">0</span>)
            {
                <span class="hljs-built_in">agent</span> a &lt;- first(tmp <span class="hljs-built_in">sort</span> (each.shape distance_to self.shape));
                <span class="hljs-keyword">if</span> (a = <span class="hljs-literal">nil</span>)
                {
                    a &lt;- any((lstPrey where (!dead(each))));
                }

                <span class="hljs-keyword">if</span> (a != <span class="hljs-literal">nil</span>)
                {
                    <span class="hljs-built_in">speed</span> &lt;- <span class="hljs-number">2.0</span>;
                    goal &lt;- a.<span class="hljs-built_in">location</span>;
                }

            }

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((self.<span class="hljs-built_in">location</span> distance_to goal &lt; <span class="hljs-number">0.5</span>))
        {
            ask lstPrey where (!dead(each) <span class="hljs-built_in">and</span> each.<span class="hljs-built_in">location</span> distance_to goal &lt; <span class="hljs-number">0.5</span>)
            {
                <span class="hljs-keyword">do</span> die;
            }

            goal &lt;- <span class="hljs-literal">nil</span>;
            <span class="hljs-built_in">speed</span> &lt;- <span class="hljs-number">1.0</span>;
        }

    }

    aspect <span class="hljs-keyword">default</span>
    {
        draw circle(perceipt_radius) color: <span class="hljs-meta"># pink empty: true;</span>
        draw shape color: color rotate: <span class="hljs-number">90</span> + my heading;
    }

}

experiment prey_predator_exp <span class="hljs-built_in">type</span>: gui
{
    output
    {
        display main_display

        {
            species prey;
            species predator;
        }

    }

}
</code></pre>
<pre><code class="hljs lasso">model PreyPredator_coupling
<span class="hljs-keyword">import</span> <span class="hljs-string">"PreyPredator.gaml"</span>

<span class="hljs-built_in">global</span>
{   
}

experiment PreyPredator_coupling_exp <span class="hljs-keyword">parent</span>:prey_predator_exp <span class="hljs-keyword">type</span>: gui
{
geometry shape&lt;- square(<span class="hljs-number">100</span>);
    <span class="hljs-built_in">list</span>&lt;prey&gt; getPrey{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(prey);
    }
        <span class="hljs-built_in">list</span>&lt;predator&gt; getPredator{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(predator);
    }
    
    <span class="hljs-comment">//if we redefine the output, i.e, a blank output, the displays in parent experiement dont show.</span>
    output
    {
    }

}

</code></pre>
<p>Code of the model : </p>
<pre><code class="hljs xl">model comodel_mix_behaviors

<span class="hljs-keyword">import</span> <span class="hljs-string">"PreyPredator_coupling.gaml"</span> <span class="hljs-keyword">as</span> myPreyPredator
<span class="hljs-keyword">import</span> <span class="hljs-string">"Ants_coupling.gaml"</span> <span class="hljs-keyword">as</span> myAnt


global
{
    <span class="hljs-comment">//set the shape of environment: square 100 </span>
    geometry shape &lt;- square(<span class="hljs-number">100</span>);
    <span class="hljs-comment">// the variable that refer to the ants population in micro-model </span>
    list&lt;agent&gt; theAnts;
    <span class="hljs-comment">// the variable that refer to the prey population in micro-model</span>
    list&lt;prey&gt; thePreys;
    
    init
    {
        <span class="hljs-comment">//create the Ants micro-model with the size of grid is 100 and the population have 500 ants.</span>
        create myAnt.Ants_coupling_exp <span class="hljs-keyword">with</span>: [gridsize::<span class="hljs-number">100</span>,ants_number::<span class="hljs-number">500</span>];
        <span class="hljs-comment">//create the PreyPredator micro-model with the parameters and the number of the prey is equal with the size of ants population</span>
        create myPreyPredator.PreyPredator_coupling_exp <span class="hljs-keyword">with</span>: [shape::square(<span class="hljs-number">100</span>), preyinit::myAnt.Ants_coupling_exp[<span class="hljs-number">0</span>].simulation.ants_number, predatorinit::<span class="hljs-number">3</span>]  
        {
            <span class="hljs-comment">// set the size of micro-model PreyPredator equal with the size of the grid of myAnt</span>
            shape &lt;- square(<span class="hljs-number">100</span>);
        }

        <span class="hljs-comment">// save the original population of the Ants and the Preys</span>
        theAnts &lt;- myAnt.Ants_coupling_exp accumulate each.getAnts();
        thePreys &lt;- list&lt;prey&gt;(myPreyPredator.PreyPredator_coupling_exp accumulate each.getPrey());


    }

    reflex simulate_micro_models
    {
        <span class="hljs-comment">// ask myAnt do a step</span>
        ask (myAnt.Ants_coupling_exp collect each.simulation)
        {
            <span class="hljs-keyword">do</span> _step_;
        }
        <span class="hljs-comment">// ask myPreyPredator do a step, too</span>
        ask (myPreyPredator.PreyPredator_coupling_exp collect each.simulation)
        {
            <span class="hljs-keyword">do</span> _step_;
        }

        <span class="hljs-comment">//check if a Prey is chased, set the position of that agent to the location of prey </span>
        <span class="hljs-comment">//if not, set ant's location to agent location.</span>
        <span class="hljs-comment">// if the agent (prey) died, then tell the ant do die</span>
        <span class="hljs-keyword">loop</span> i from: <span class="hljs-number">0</span> to: length(theAnts) - <span class="hljs-number">1</span>
        {
            <span class="hljs-keyword">if</span> (!dead(thePreys <span class="hljs-built_in">at</span> i) <span class="hljs-built_in">and</span> !dead(theAnts <span class="hljs-built_in">at</span> i))
            {
                <span class="hljs-keyword">if</span> (!(thePreys <span class="hljs-built_in">at</span> i).is_chased)
                {
                    (thePreys <span class="hljs-built_in">at</span> i).location &lt;- (theAnts <span class="hljs-built_in">at</span> i).location;
                } <span class="hljs-keyword">else</span>
                {
                    (theAnts <span class="hljs-built_in">at</span> i).location &lt;- (thePreys <span class="hljs-built_in">at</span> i).location;
                }

            } <span class="hljs-keyword">else</span>
            {
                ask (theAnts <span class="hljs-built_in">at</span> i)
                {
                    <span class="hljs-keyword">do</span> die;
                }

            }

        }

    }

}

experiment comodel_mix_behaviors_exp type: gui
{
    output
    {
        display <span class="hljs-string">"comodel"</span>
        {
            agents <span class="hljs-string">"ant_grid"</span> value: myAnt.Ants_coupling_exp accumulate each.getAnt_grid() transparency: <span class="hljs-number">0.7</span>;
            agents <span class="hljs-string">"agentprey"</span> value: (myPreyPredator.PreyPredator_coupling_exp accumulate each.getPrey());
            agents <span class="hljs-string">"agentpredator"</span> value: (myPreyPredator.PreyPredator_coupling_exp accumulate each.getPredator());
        }

    }

}
</code></pre>
<script>hljs.initHighlightingOnLoad();</script></body></html>